I"¼Ÿ<p>é—²æ¥æ— äº‹ï¼Œå‰æ®µæ—¶é—´çœ‹äº†ä¸€ä¸ªæœ‰å…³ C++20 ranges library çš„ç½‘é¡µï¼Œé‡Œé¢æ¨èäº†è¿™ç¯‡ paper P0557r1ï¼ˆé¼»ç¥–ï¼‰ï¼Œæ­£å¥½æ—©æƒ³äº†è§£ä¸€ä¸‹ concepts äº†ï¼Œäºæ˜¯å°±èŠ±ç‚¹æ—¶é—´è¯»ä¸€ä¸‹å†™ç‚¹æŠ¥å‘Šå§ã€‚ <br />
Download link: <a href="http://www.stroustrup.com/good_concepts.pdf">http://www.stroustrup.com/good_concepts.pdf</a></p>

<h2 id="1-a-bit-of-background">1. A bit of background</h2>
<p>å…³äºèƒŒæ™¯è¿™å—ï¼Œæˆ‘äº†è§£çš„æ˜¯æ¯”è¾ƒå°‘çš„ï¼Œå› ä¸ºå¹³æ—¶ä¹Ÿæ²¡æœ‰å¼€å‘è¿‡ä»€ä¹ˆè¾ƒå¤§æˆ–è¾ƒéš¾çš„ C++ é¡¹ç›®ï¼Œå¯¹æ¨¡æ¿è¿™å—ç†è§£è¿˜æ˜¯ä¸å¤Ÿã€‚å½“ç„¶ï¼Œæœ‰æœºä¼šè¿˜æ˜¯ä¼šå›å»è¯» <em>C++ Templates</em> çš„ã€‚<br />
ä¼ ç»Ÿçš„ C++ï¼Œæ— æ³•æä¾›å¾ˆå¥½çš„ã€å¯¹æ¨¡æ¿å‚æ•°çš„é™åˆ¶ï¼Œæ¢å¥è¯è¯´å°±æ˜¯æ— æ³•ä¿è¯æ¨¡æ¿å‚æ•°çš„æ­£ç¡®ã€‚1987å¹´ï¼Œpaper çš„ä½œè€…æƒ³è¦è®¾è®¡æ»¡è¶³ä¸‹åˆ—ä¸‰é¡¹çš„æ¨¡æ¿ï¼š</p>
<ul>
  <li>Full generality/expressiveness</li>
  <li>Zero overhead compared to hand coding</li>
  <li>Well-specified interfaces</li>
</ul>

<p>ä½†æ˜¯å®é™…ä»è®¾è®¡ä¸­çš„ä»£ç ä¸­å¾—åˆ°çš„åé¦ˆï¼Œæœ‰ä¸€ä¸‹ä¸‰ä¸ªé—®é¢˜æ˜¯ï¼š</p>
<ul>
  <li>Turing completeness</li>
  <li>Better than hand-coding performance</li>
  <li>Lousy interfaces (basically compile-time duck typing)</li>
</ul>

<p>å›¾çµå®Œå¤‡æˆ‘ä¸æ˜¯å¾ˆæ‡‚ï¼Œæ€§èƒ½å’Œç¼–è¯‘æœŸé¸­å­ç±»å‹ç¨å¾®å¯ä»¥ç†è§£ä¸€ç‚¹ã€‚</p>

<p>äºæ˜¯ä½œè€…å’Œå¦å¤–ä¸¤ä½å¤§ä½¬åœ¨ 2009 å¼€å§‹èµ·è‰è®¾è®¡ conceptsã€‚ä¸€æ³¢ä¸‰æŠ˜ä¹‹åï¼Œconcepts ä½œä¸º ISO Technical Specification åŠ å…¥äº† C++15.</p>

<h2 id="2-generic-programming">2. Generic Programming</h2>
<p>è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹æ³›å‹ç¼–ç¨‹çš„è¯ç”Ÿè¿‡ç¨‹ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ä¼ ç»Ÿä»£ç </span>
<span class="kt">double</span> <span class="nf">sqrt</span><span class="p">(</span><span class="kt">double</span> <span class="n">d</span><span class="p">);</span>    <span class="c1">// C++84: æ¥å—ä»»ä½•ä¸€ä¸ªä»¥ double å‹çš„ d</span>

<span class="kt">double</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>     <span class="c1">// fine: d is a double</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">vs</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Good"</span><span class="p">,</span> <span class="s">"old"</span><span class="p">,</span> <span class="s">"templates"</span><span class="p">};</span>
<span class="kt">double</span> <span class="n">d3</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">vs</span><span class="p">);</span>    <span class="c1">// error: vs is not a double</span>
</code></pre></div></div>
<p><em>çœ‹ä»–è¿™ä¸ªæ„æ€åº”è¯¥æ˜¯ 80s è¿˜æ²¡æœ‰å‡½æ•°æ¨¡æ¿ï¼Ÿ</em></p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1990s style generic code:</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// æ’åºçš„ç®—æ³•ä»£ç </span>
    <span class="c1">// ä½†æ˜¯å¯èƒ½ä¼šä¾èµ– T ç±»å‹çš„ï¼Œæ¯”å¦‚ [], &lt; æ“ä½œç¬¦</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">vs</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Good"</span><span class="p">,</span> <span class="s">"old"</span><span class="p">,</span> <span class="s">"templates"</span><span class="p">};</span>
<span class="n">sort</span><span class="p">(</span><span class="n">vs</span><span class="p">);</span>      <span class="c1">// fine</span>

<span class="kt">double</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="n">sort</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>   <span class="c1">// error: d æ²¡æœ‰ [] æ“ä½œç¬¦</span>
</code></pre></div></div>
<p>è¿™é‡Œä¼šé‡åˆ°ä¸å°‘é—®é¢˜ï¼š</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">sort(d)</code> çš„é”™è¯¯æé†’æ˜¯å†—é•¿ã€ç»™çš„å»ºè®®ä¸ç²¾ç¡®ï¼Œç®€å•è¯´å°±æ˜¯åºŸè¯è¿ç¯‡ã€‚è¿™ä¸ªçœŸçš„æ˜¯å¹³æ—¶å†™ C++ é‡åˆ°è¿‡æœ€æ¶å¿ƒçš„äº‹æƒ…äº†ï¼Œæ·±æœ‰ä½“ä¼šï¼Œæˆ‘ä¹Ÿä¸èµ˜è¿°äº†ã€‚</li>
  <li>å‡½æ•°æ¨¡æ¿çš„å£°æ˜å’Œå®šä¹‰å¿…é¡»è¦å†™ä¸€èµ·ã€‚ä¸¥é‡ç ´åä»£ç ç»“æ„ã€‚</li>
  <li>å‚æ•°ç±»å‹å¯¹ <code class="language-plaintext highlighter-rouge">sort</code> æ˜¯éšè—çš„ã€‚</li>
  <li>é”™è¯¯ä¿¡æ¯åªä¼šåœ¨ <code class="language-plaintext highlighter-rouge">sort</code> æ¨¡æ¿å®Œæˆå®ä¾‹åŒ–åæ‰ä¼šå‡ºç°ï¼Œè€Œä¸”è°ƒè¯•ä¸Šä¼šé‡åˆ°éº»çƒ¦ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">template&lt;typename T&gt;</code> éå¸¸å†—é•¿ã€å—é™åˆ¶ã€‚</li>
</ul>

<p>äº†è§£åˆ°è¿™äº›é—®é¢˜ä¹‹åï¼Œä»–ä»¬å°±æƒ³è®¾è®¡ä¸€ç§æ–¹æ¡ˆï¼Œç±»ä¼¼ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="n">Sortable</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">);</span>
</code></pre></div></div>

<p>è¿™æ ·çš„ä»£ç çš„ä¼˜ç‚¹ï¼š</p>
<ul>
  <li>simple çš„æ³›å‹ä»£ç å’Œéæ³›å‹ä»£ç ä¸€æ · simpleã€‚</li>
  <li>advanced çš„æ³›å‹ä»£ç æ„å»ºèµ·æ¥ä¼šæ¯”åŸæ¥å®¹æ˜“å¤ªå¤šã€‚</li>
</ul>

<h2 id="3-using-concepts">3. Using Concepts</h2>
<p>concept æ˜¯ä¸€ä¸ªç¼–è¯‘æœŸè°“è¯ï¼Œæ¢å¥è¯è¯´å®ƒä¼š yields ä¸€ä¸ªå¸ƒå°”å€¼ã€‚æ¯”å¦‚ä¸€ä¸ª concept <code class="language-plaintext highlighter-rouge">C</code>ï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">C&lt;T&gt;</code> è¿™æ ·çš„è¡¨è¾¾å¼è¡¨ç¤ºâ€œ<code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">T</code> æ»¡è¶³ <code class="language-plaintext highlighter-rouge">C</code> çš„éœ€æ±‚ï¼Œ<code class="language-plaintext highlighter-rouge">false</code> otherwiseâ€ã€‚è€Œä¸”è¿™è¿˜ä¸ä¸€å®šæ˜¯ä¸€ä¸ªä¸€å…ƒè°“è¯ï¼Œæ¯”å¦‚å¯ä»¥æœ‰ä¸ª concept ç±»ä¼¼ <code class="language-plaintext highlighter-rouge">Mergeable&lt;In1, In2, Out&gt;</code>ã€‚è¿™ç§è°“è¯ç›¸æ¯”ä¼ ç»Ÿçš„æ¨¡æ¿å…ƒç¼–ç¨‹è§£å†³æ–¹æ¡ˆè¦æ–¹ä¾¿å¤ªå¤šï¼ˆè¿™äº›å…ƒç¼–ç¨‹æŠ€æœ¯åœ¨ STL ä¸­æ¼”å˜å‡ºæ¥çš„å°±æ˜¯ <code class="language-plaintext highlighter-rouge">traits</code> æŠ€æœ¯äº†ï¼Œå™©æ¢¦ï¼‰ã€‚<br />
å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è‡ªå·±çš„ conceptï¼Œè€Œä¸”ä¹Ÿä¼šæœ‰ concepts åº“è¿™ç§ä¸œè¥¿ã€‚</p>

<h3 id="31-specifying-template-interfaces">3.1 Specifying template interfaces</h3>
<p>é¦–å…ˆçœ‹ä¸‹æ€ä¹ˆç”¨ concepts å»ä¿®é¥° <code class="language-plaintext highlighter-rouge">std::find()</code> çš„å˜ä½“ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">S</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
        <span class="n">requires</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span> <span class="n">Equality_comparable</span><span class="o">&lt;</span><span class="n">Value_type</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">Iterator_of</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span> <span class="n">find</span><span class="p">(</span><span class="n">S</span><span class="o">&amp;</span> <span class="n">seq</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>
</code></pre></div></div>
<p>è¿™é‡Œçš„ä¸¤ä¸ª concepts ç®€å•åˆ°é¡¾åæ€ä¹‰äº†ï¼š<code class="language-plaintext highlighter-rouge">Sequence&lt;S&gt;</code> è¡¨ç¤ºéœ€è¦ <code class="language-plaintext highlighter-rouge">S</code> ç±»å‹æ»¡è¶³â€œæœ‰ <code class="language-plaintext highlighter-rouge">begin()</code> å’Œ <code class="language-plaintext highlighter-rouge">end()</code> æˆå‘˜å‡½æ•°â€ï¼›<code class="language-plaintext highlighter-rouge">Equality_comparable&lt;Value_type&lt;S&gt;, T&gt;</code> åˆ™æ˜¯è¦æ±‚ <code class="language-plaintext highlighter-rouge">Value_type&lt;S&gt;</code> ä¸ <code class="language-plaintext highlighter-rouge">T</code> ä¹‹é—´è¦èƒ½â€œç”¨ <code class="language-plaintext highlighter-rouge">==</code>è¿›è¡Œæ¯”è¾ƒâ€ã€‚<br />
å¦å¤–æ˜¯æ¯”è¾ƒç®€å•çš„ alias templatesï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">X</span><span class="p">&gt;</span> <span class="k">using</span> <span class="n">Value_type</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">X</span><span class="o">::</span><span class="n">value_type</span><span class="p">;</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">X</span><span class="p">&gt;</span> <span class="k">using</span> <span class="n">Iterator_of</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">X</span><span class="o">::</span><span class="n">iterator</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="32-a-short-hand-notation">3.2 A short-hand notation</h3>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="n">Sequence</span> <span class="n">Seq</span><span class="p">&gt;</span>
<span class="kt">void</span> <span class="nf">algo</span><span class="p">(</span><span class="n">Seq</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
</code></pre></div></div>
<p>è¿™æ ·çš„è¯­æ³•æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="n">C</span> <span class="n">T</span><span class="p">&gt;</span>
</code></pre></div></div>
<p>å°±æ˜¯</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
        <span class="n">requires</span> <span class="n">C</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
</code></pre></div></div>
<p>çš„æ„æ€ã€‚</p>

<h2 id="4-defining-concepts">4. Defining concepts</h2>
<p>ç›´æ¥çœ‹è¯­æ³•ï¼Œä»¥ <code class="language-plaintext highlighter-rouge">Equality_comparable</code> ä¸ºä¾‹ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="kt">bool</span> <span class="n">Equality_comparable</span> <span class="o">=</span> 
        <span class="n">requires</span> <span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">{</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span>
            <span class="p">{</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span>
        <span class="p">};</span>
</code></pre></div></div>
<p>æ„æ€æ˜¯ <code class="language-plaintext highlighter-rouge">T</code> ç±»å‹å¿…é¡»æä¾›è¿”å› <code class="language-plaintext highlighter-rouge">bool</code> ç±»å‹çš„ <code class="language-plaintext highlighter-rouge">==</code> å’Œ <code class="language-plaintext highlighter-rouge">!=</code>ï¼ˆè¿™é‡Œè¯´å‡†ç¡®ä¸€ç‚¹æ˜¯è¿”å›å¯è½¬æ¢ä¸º <code class="language-plaintext highlighter-rouge">bool</code> å‹çš„ç±»å‹ï¼‰ã€‚<br />
<code class="language-plaintext highlighter-rouge">requires</code> è¡¨è¾¾å¼ä¸ä¼šå®é™…æ‰§è¡Œï¼Œä½†æ˜¯å®ƒå¯ä»¥å·¦å³ç¼–è¯‘å™¨çš„è¡Œä¸ºã€‚<br />
å†çœ‹ç¨å¾®å¤æ‚ä¸€ç‚¹çš„ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="kt">bool</span> <span class="n">Sequence</span> <span class="o">=</span>
        <span class="n">requires</span><span class="p">(</span><span class="n">T</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">typename</span> <span class="n">Value_type</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
            <span class="k">typename</span> <span class="n">Iterator_of</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>

            <span class="p">{</span> <span class="n">begin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">Iterator_of</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
            <span class="p">{</span> <span class="n">end</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">Iterator_of</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>

            <span class="n">requires</span> <span class="n">Input_iterator</span><span class="o">&lt;</span><span class="n">Iterator_of</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>
            <span class="n">requires</span> <span class="n">Same_type</span><span class="o">&lt;</span><span class="n">Value_type</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">Value_type</span><span class="o">&lt;</span><span class="n">Iterator_of</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span><span class="p">;</span>
        <span class="p">};</span>
</code></pre></div></div>
<p>è¿™é‡Œå¾ˆæ˜æ˜¾æ˜¯åœ¨è¯´æ˜ <code class="language-plaintext highlighter-rouge">typename</code> å£°æ˜å…³è”ç±»å‹å’Œ <code class="language-plaintext highlighter-rouge">requires</code> åµŒå¥—çš„è¯­æ³•ã€‚</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="kt">bool</span> <span class="n">Sortable</span> <span class="o">=</span>
        <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span>
        <span class="n">Random_access_iterator</span><span class="o">&lt;</span><span class="n">Iterator_of</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">&amp;&amp;</span>
        <span class="n">Less_than_comparable</span><span class="o">&lt;</span><span class="n">Value_type</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</code></pre></div></div>
<p>è¿™é‡Œè¯´æ˜äº† concepts å¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> æ“ä½œç¬¦è¿æ¥ï¼ˆæˆ‘è®°å¾—æ²¡é”™çš„è¯ <code class="language-plaintext highlighter-rouge">||</code> ä¹Ÿå¯ä»¥ï¼‰ã€‚<br />
ç„¶åè¦æ³¨æ„ä¸€ä¸‹åŒå‚æ•°çš„ <code class="language-plaintext highlighter-rouge">Equality_comparable</code> conceptï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">U</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="kt">bool</span> <span class="n">Equality_comparable</span> <span class="o">=</span> 
        <span class="n">requires</span> <span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">U</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">{</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span>
            <span class="p">{</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span>
            <span class="p">{</span> <span class="n">b</span> <span class="o">==</span> <span class="n">a</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span>
            <span class="p">{</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">a</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span>
        <span class="p">};</span>
</code></pre></div></div>
<p>è¿™ä¸ªæ¯”è¾ƒè¦æ˜¯åŒå‘çš„ã€‚</p>

<h2 id="5-designing-with-concepts">5. Designing with concepts</h2>
<p>paper ä¸­æåˆ°çš„â€œæœ¬ paper ä¸­æœ€é‡è¦çš„éƒ¨åˆ†â€ï¼šæœ‰å…³å¦‚ä½•è®¾è®¡ good conceptsã€‚</p>

<h3 id="51-typeconcept-accidental-match">5.1 Type/concept accidental match</h3>
<p>è®© concept æä¾›ä¸€äº›åŸºç¡€æ¦‚å¿µâ€”â€”å¦‚æ“ä½œç¬¦å’Œæˆå‘˜ç±»å‹ã€‚åŸæ–‡ä¸­ä¸¾äº†ä¸¤ä¸ªåä¾‹ï¼š<br />
ç¬¬ä¸€ä¸ªï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="kt">bool</span> <span class="n">Drawable</span> <span class="o">=</span> <span class="n">requires</span><span class="p">(</span><span class="n">T</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span> <span class="n">t</span><span class="p">.</span><span class="n">draw</span><span class="p">();</span> <span class="p">};</span>
</code></pre></div></div>
<p>è¿™ä¸ª Drawable æ˜¯ç”¨æ¥è§£å†³ OO é—®é¢˜çš„ã€‚æˆ‘ä»¬æƒ³è¡¨è¾¾çš„æ„æ€æ˜¯ï¼š<code class="language-plaintext highlighter-rouge">T</code> æ˜¯ä¸€ä¸ªèƒ½â€œç»˜ç”»(draw)çš„â€æŸç‰©ã€‚ä½†æ˜¯å¾ˆç³Ÿç³•çš„æ˜¯ï¼Œèƒ½â€œæ‹‰ã€å¸å¼•(draw)çš„â€çš„æŸç‰©ä¹Ÿè¢«åŒ…å«äº†è¿›æ¥ã€‚è¿™æ˜¯ä¸€ç§ concept å’Œ type çš„èŒƒå›´çš„ä¸åŒ¹é…ã€‚<br />
ç¬¬äºŒä¸ªï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="kt">bool</span> <span class="n">Addable</span> <span class="o">=</span> <span class="n">requires</span><span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="p">{</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">;</span> <span class="p">};</span>
</code></pre></div></div>
<p>å¯åŠ çš„ã€‚å¯¹äºæ™®é€šçš„æ•°å­—æ¥è¯´ç¡®å®æ²¡é”™ï¼Œä½†æ˜¯å¯¹äº <code class="language-plaintext highlighter-rouge">string</code> è€Œè¨€ï¼Œè™½ç„¶å®ƒæœ‰å¯¹ <code class="language-plaintext highlighter-rouge">operator+()</code> é‡è½½ï¼Œä½†æ˜¯è¡¨è¾¾çš„æ˜¯â€œå­—ç¬¦ä¸²æ‹¼æ¥â€çš„æ„æ€ï¼Œè€Œå¹¶ä¸æ˜¯â€œåŠ æ³•â€çš„æ„æ€ã€‚è¿™æ˜¯å¦ä¸€ç§ concept å’Œ type çš„ä¸åŒ¹é…ã€‚</p>

<p>äºæ˜¯è¿™ä¸ªéƒ¨åˆ†æƒ³å‘Šè¯‰æˆ‘ä»¬çš„ï¼šä¸è¦è®©ä½ çš„è®¾è®¡å—åˆ°è‡ªç„¶è¯­è¨€çš„å½±å“äº†ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯ï¼Œä¸è¦å› ä¸ºä»¥è‡ªç„¶è¯­è¨€å‘½åçš„ concept äº§ç”Ÿæ­§ä¹‰ï¼Œè¿™æ˜¯ä¸€ç§å¯¹è®¾è®¡çš„ç ´åã€‚</p>

<h3 id="52-semantics">5.2 Semantics</h3>
<p>è¦ä»è¯­ä¹‰å­¦è§’åº¦å‡ºå‘è®¾è®¡ conceptsã€‚è¿™ä¸ªæˆ‘ä¸æ˜¯å¾ˆæ‡‚ï¼Œä½†æ˜¯æ–‡ä¸­åˆ—ä¸¾äº†å‡ ä¸ªç”¨å¤„ï¼š</p>
<ul>
  <li>C/C++ å†…ç½®ç±»å‹çš„ conceptsï¼ˆæ¢å¥è¯è¿™é‡Œåº”è¯¥å¯ä»¥è¯´ PODï¼‰ï¼šç®—æœ¯è¿ç®—ã€å­—é¢å€¼ã€æµ®ç‚¹ã€‚ï¼ˆç„¶åè¿™é‡Œæåˆ°äº†ä¸€å¥å‰é¢çš„ C ä¸æ˜¯å¤šä½™çš„ï¼ŒC ä¹Ÿæœ‰ conceptsï¼‰ã€‚</li>
  <li>STL ä¸­çš„ conceptsï¼Œæ¯”å¦‚è¿­ä»£å™¨ã€å®¹å™¨ã€‚</li>
  <li>æ•°å­¦ conceptsï¼Œæ¯”å¦‚åŠå¹ºç¾¤ï¼ˆmonoidï¼‰ã€ç¾¤ï¼ˆgroupï¼‰ã€ç¯ï¼ˆringï¼‰ã€åŸŸï¼ˆfieldï¼‰ã€‚</li>
  <li>å›¾è®º conceptsï¼Œæ¯”å¦‚è¾¹ã€èŠ‚ç‚¹ï¼›å›¾ã€DAG ç­‰ç­‰ã€‚</li>
</ul>

<p>åŒæ ·çš„ï¼Œè®¾è®¡è¿™äº› concepts éœ€è¦è€ƒç©¶èƒ½åŒ¹é…ä¸€ä¸ªé¢†åŸŸæ¦‚å¿µçš„å®Œæ•´ï¼ˆå¿…é¡»ä¸”è¶³å¤Ÿçš„ï¼Œè¯´ä¸­æ–‡å°±æ˜¯ä¸å¤šä¸å°‘ï¼‰çš„å±æ€§ï¼ˆåŒ…æ‹¬æ“ä½œç¬¦ã€ç±»å‹ç­‰ï¼‰é›†åˆã€‚</p>

<h3 id="53-ideals-for-concept-design">5.3 Ideals for concept design</h3>
<p>è¿™é‡Œæåˆ°çš„æ˜¯ä¸€ä¸ªå« â€œplug compatibleâ€ çš„æ¦‚å¿µï¼Œè¯´äººè¯å°±æ˜¯ï¼š</p>
<ul>
  <li>æˆ‘ä»¬æƒ³åˆ°å†™å‡ºæ¥çš„ç®—æ³•æ”¯æŒçš„ç±»å‹çš„æ›´å¤šå˜ä½“</li>
  <li>æˆ‘ä»¬æƒ³è¦å®šä¹‰çš„ç±»å‹æ”¯æŒçš„ç®—æ³•çš„æ›´å¤šå˜ä½“</li>
</ul>

<p>æ³¨æ„ï¼Œè¿™é‡Œä¸æ˜¯è¯´æ”¯æŒâ€œæ›´å¤šçš„â€ç±»å‹å’Œâ€œæ›´å¤šçš„â€ç®—æ³•ã€‚æ¥ä¸‹æ¥æˆ‘å°†ä»‹ç»ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè¯´ã€‚</p>

<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ <code class="language-plaintext highlighter-rouge">accumulate</code>ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="n">Forward_iterator</span> <span class="n">Iter</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">Val</span><span class="p">&gt;</span>
        <span class="n">requires</span> <span class="n">Incrementable</span><span class="o">&lt;</span><span class="n">Val</span><span class="p">,</span> <span class="n">Value_type</span><span class="o">&lt;</span><span class="n">Iter</span><span class="o">&gt;&gt;</span>
<span class="n">Val</span> <span class="nf">sum</span><span class="p">(</span><span class="n">Iter</span> <span class="n">first</span><span class="p">,</span> <span class="n">Iter</span> <span class="n">last</span><span class="p">,</span> <span class="n">Val</span> <span class="n">acc</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">!=</span> <span class="n">last</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">acc</span> <span class="o">+=</span> <span class="o">*</span><span class="n">first</span><span class="p">;</span>
        <span class="o">++</span><span class="n">first</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">acc</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>å¾ˆå¥½ï¼Œè¿™é‡Œä½¿ç”¨äº† <code class="language-plaintext highlighter-rouge">Incrementable</code> concept æ¥è¯·æ±‚ <code class="language-plaintext highlighter-rouge">+=</code> æ“ä½œç¬¦çš„æ”¯æŒã€‚ä½†æ˜¯ï¼š</p>
<ul>
  <li>æˆ‘ä»¬å¹¶æ²¡æœ‰è€ƒè™‘ <code class="language-plaintext highlighter-rouge">Val</code> ç±»å‹æ˜¯å¦ copyable ä¸”/æˆ– movable.</li>
  <li>æˆ‘ä»¬ä¸èƒ½å¯¹ä¸€ä¸ªåªæä¾› <code class="language-plaintext highlighter-rouge">+</code> å’Œ <code class="language-plaintext highlighter-rouge">=</code> è€Œä¸æä¾› <code class="language-plaintext highlighter-rouge">+=</code> çš„ <code class="language-plaintext highlighter-rouge">Val</code> ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">sum</code>.</li>
</ul>

<p>è¿™ä¹Ÿå°±æ˜¯ä¸Šé¢ä¸è¯´â€œæ›´å¤šçš„â€çš„åŸå› ã€‚æˆ‘ä»¬çš„ idealï¼Œæ˜¯ä¸æ˜¯è¦æ»¡è¶³â€œæœ€å°åŒ–çš„éœ€æ±‚â€ï¼Œè€Œæ˜¯â€œä½¿å¾—éœ€æ±‚æ­£å¥½å¤Ÿç”¨â€ã€‚</p>

<h3 id="54-constraints">5.4 Constraints</h3>
<p>è¿™éƒ¨åˆ†ä¾æ—§æ˜¯åœ¨è¯´ concept è®¾è®¡å®Œæ•´æ€§çš„ï¼Œå¤§æ®µè‹±æ–‡æˆ‘æ²¡æœ‰è¯»æ‡‚ã€‚<br />
å¦‚æœä¸€ä¸ª concept å¯¹äºå¹¿æ³›ç”¨é€”è®¾è®¡çš„è¿‡äº simple äº†ä¸”/æˆ–ç¡®è®¤ç®€æ˜çš„è¯­ä¹‰ï¼Œåˆ™å¯ä»¥ç”¨äºä¸ºæ›´å®Œæ•´çš„ concept æ·»ç –åŠ ç“¦ã€‚æœ‰æ—¶å€™æˆ‘ä»¬å°±è¯´è¿™äº›è¿‡äºç®€å•æˆ–è€…ä¸å®Œæ•´çš„ concepts â€œconstraintsâ€ï¼Œç”¨äºä¸ â€œreal conceptsâ€ ç›¸åŒºåˆ†ã€‚</p>

<h3 id="55-matching-types-to-concepts">5.5 Matching types to concepts</h3>
<p>è¿™ä¸€éƒ¨åˆ†æ•™æˆ‘ä»¬æ€ä¹ˆåˆ¤æ–­ä¸€ä¸ª type æ˜¯å¦åŒ¹é…ä¸€ä¸ª conceptã€‚</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">My_number</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">};</span>
<span class="k">static_assert</span><span class="p">(</span><span class="n">Number</span><span class="o">&lt;</span><span class="n">My_number</span><span class="o">&gt;</span><span class="p">);</span>
</code></pre></div></div>
<p>C++11 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç±»å‡½æ•°çš„å…³é”®å­— <code class="language-plaintext highlighter-rouge">static_assert</code> ç”¨äºé™æ€æ–­è¨€ã€‚<br />
åŒæ ·ä½œä¸ºæ–­è¨€ï¼Œ<code class="language-plaintext highlighter-rouge">std::assert()</code> ç”¨äºä¸€ä¸ªå¸ƒå°”å€¼æ–­è¨€ï¼Œè¿è¡Œæ—¶æ‰§è¡Œï¼›<code class="language-plaintext highlighter-rouge">static_assert</code> ç”¨äºä¸€ä¸ªè°“è¯ï¼Œç¼–è¯‘æœŸç”±ç¼–è¯‘å™¨åˆ¤å®šã€‚</p>

<h3 id="56-gradual-introduction-of-concepts">5.6 Gradual introduction of concepts</h3>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="n">Sortable</span> <span class="n">S</span><span class="p">&gt;</span>
<span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="n">S</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
</code></pre></div></div>
<p>æˆ‘ä»¬çš„ <code class="language-plaintext highlighter-rouge">sort</code> éœ€è¦å‚æ•° <code class="language-plaintext highlighter-rouge">s</code> æ˜¯ sortable çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“ <code class="language-plaintext highlighter-rouge">std::sort</code> éœ€è¦ä»€ä¹ˆï¼Œå³ä½¿æˆ‘ä»¬æœ‰ä»”ç»†é˜…è¯»æ ‡å‡†ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½æ¼æ‰ requirementsï¼›å†è¿›ä¸€æ­¥ï¼Œåœ¨è°ƒç”¨å¤„ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æŸä¸€ä¸ªå‡½æ•°çš„å®ç°ä¸­æ˜¯ä¸æ˜¯æœ‰ä¸€äº› facilities æ˜¯æˆ‘ä»¬æ²¡æœ‰ required åˆ°çš„ï¼›å†è¿›ä¸€æ­¥ï¼Œå‡½æ•°çš„å®ç°éšæ—¶å¯èƒ½æ”¹å˜ï¼Œéœ€æ±‚ä¹Ÿéšæ—¶åœ¨æ”¹å˜ã€‚<br />
ä½†æ˜¯è¿™å¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªæ‹…å¿ƒçš„ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ requires ä¸­æä¾›çš„æ–°æ·»åŠ çš„éœ€æ±‚ï¼Œä¹Ÿåªä¸è¿‡æ˜¯æŠŠæŠ¥é”™ä¿¡æ¯æå‰äº†è€Œå·²ã€‚</p>

<p>å¦å¤–è¿™é‡Œæåˆ°çš„æ˜¯ç¼–è¯‘å™¨ã€å¹³å°ä¸ concepts çš„å…¼å®¹é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸€ä¸ªè€æ¬¾çš„ç¼–è¯‘å™¨æˆ–è€…åœ¨ç¼–è¯‘å™¨å‚æ•°ä¸Šè®¾å®šä½¿ç”¨è€ç‰ˆæœ¬ç¼–è¯‘ï¼Œæˆ‘ä»¬æœ‰å…³ requires çš„ä»£ç å°±ä¸èƒ½ä½¿ç”¨äº†ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸å®¹æ˜“ä¸”ä½¿ç”¨çš„æŠ€æœ¯â€”â€”å®ã€‚</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef GOOD_COMPILER
#define REQUIRES requires
#elseif
#define REQUIRES //
#endif
</span></code></pre></div></div>
<p>å¯¹äº short-hand conceptsï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef GOOD_COMPILER
#define SORTABLE Sortable
#define ITERATOR Iterator
#elseif
#define SORTABLE auto
#define ITERATOR auto
#endif
</span></code></pre></div></div>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å†™æ›´å¤æ‚çš„ä»£ç è®©è€ç‰ˆæœ¬ä¹Ÿèƒ½è¿›è¡Œä¸€å®šçš„ concepts åˆ¤å®šï¼Œæ¯”å¦‚ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">enable_if</code>ï¼Œåœ¨è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>

<h2 id="6-concept-overloading">6. Concept overloading</h2>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Iter</span><span class="p">&gt;</span> <span class="kt">void</span> <span class="nf">advance</span><span class="p">(</span><span class="n">Iter</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
</code></pre></div></div>
<p>å¯¹äºè¿™æ ·ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">advance()</code> æ¨¡æ¿ï¼Œæˆ‘ä»¬æƒ³åˆ°å¯¹äºä¸åŒçš„è¿­ä»£å™¨æ‰§è¡Œä¸åŒçš„è¡Œä¸ºï¼š</p>
<ul>
  <li>åŸºæœ¬çš„ forward iterators å°±ä½¿ç”¨å¾ªç¯è¿›è¡Œé€æ¬¡è‡ªå¢ã€‚</li>
  <li>random-access iterators å¯ä»¥ç›´æ¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">+=</code> è¿›è¡Œä½ç§»ã€‚</li>
</ul>

<p>æˆ‘ä»¬çŸ¥é“ï¼Œè¿™æ˜¯å¯ä»¥ä½¿ç”¨ traits ä¸­çš„ <code class="language-plaintext highlighter-rouge">std::true_type</code> å’Œ <code class="language-plaintext highlighter-rouge">std::false_type</code> é…åˆ iterator category ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯ SFINAEã€‚ä½†æ˜¯ä½œè€…ä»–ä»¬æœ¬èº«åˆ›é€  concepts å°±æ˜¯ä¸ºäº†å¸Œæœ›â€œsimple çš„æ³›å‹ä»£ç å’Œéæ³›å‹ä»£ç ä¸€æ · simpleâ€ï¼ˆè§æœ¬ md æ–‡ä»¶ L68ï¼‰ï¼Œäºæ˜¯ä»–ä»¬å¸Œæœ›ï¼Œconcepts ä¹Ÿèƒ½å¸®åŠ©å‡½æ•°è¿›è¡Œé‡è½½ï¼Œæ¯”å¦‚åƒè¿™æ ·ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">advance</span><span class="p">(</span><span class="n">Forward_iterator</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="o">--</span><span class="p">)</span>
        <span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">advance</span><span class="p">(</span><span class="n">Random_access_iterator</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">p</span> <span class="o">+=</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>æ¥ç€æˆ‘ä»¬è¦ä¸ºå¦‚æ­¤çš„ concept åŒ¹é…åˆ¶å®šåŸºæœ¬è§„åˆ™ï¼š</p>
<ul>
  <li>å¦‚æœä»…èƒ½åŒ¹é…æŸä¸€ä¸ªå‡½æ•°é‡è½½çš„ concept éœ€æ±‚ï¼Œåˆ™è°ƒç”¨å®ƒ</li>
  <li>å¦‚æœåŒ¹é…ä¸åˆ°ä»»ä½•ä¸€ä¸ªå‡½æ•°é‡è½½çš„ concept éœ€æ±‚ï¼Œè¿™ä¸ªè°ƒç”¨å°±æ˜¯é”™è¯¯çš„</li>
  <li>å¦‚æœåŒ¹é…åˆ°ä¸¤ä¸ªï¼Œåˆ™éœ€è¦åˆ¤å®šå…¶ä¸­ä¸€ä¸ª requirements æ˜¯ä¸æ˜¯å¦ä¸€ä¸ªçš„å­é›†ï¼š
    <ul>
      <li>å¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨æ›´ä¸¥æ ¼ requirements çš„é‚£ä¸€ä¸ª</li>
      <li>å¦‚æœä¸æ˜¯ï¼Œåˆ™è°ƒç”¨é”™è¯¯ï¼ˆä¹Ÿå°±æ˜¯ ambiguousï¼‰</li>
    </ul>
  </li>
</ul>

<p>å…¶å®ä¸ç®¡æ˜¯æ ¹æ®å¸¸è¯†ï¼Œè¿˜æ˜¯ iterator category çš„ç»§æ‰¿å…³ç³»ï¼Œæˆ‘ä»¬éƒ½å¾ˆæ¸…æ¥š <code class="language-plaintext highlighter-rouge">Random_access_iterator</code> å®šæ˜¯ <code class="language-plaintext highlighter-rouge">Forward_iterator</code> çš„ä¸€ä¸ªå­é›†ï¼Œæ„æ€å°±æ˜¯å‰è€…çš„è¦æ±‚æ¯”åè€…æ›´ä¸¥è‹›ï¼Œäºæ˜¯ç†æ‰€å½“ç„¶ï¼Œå¦‚æœèƒ½ä¸¤ä¸ªéƒ½åŒ¹é…ï¼Œå¿…ä¼šè°ƒç”¨ <code class="language-plaintext highlighter-rouge">Random_access_iterator</code> çš„ç‰ˆæœ¬ã€‚ <br />
ä½†æ˜¯éå¸¸å¯æƒœçš„æ˜¯ï¼Œä¸åŒäº iterator categories çš„ç»§æ‰¿å’Œå¤šæ€ï¼Œconcepts æ˜¯ä¸æ”¯æŒç»§æ‰¿çš„ã€‚å¸Œæœ›ä»¥åçš„ C++ ç‰ˆæœ¬èƒ½æ”¯æŒã€‚</p>

<h2 id="7-the-short-form-notations">7. The short-form notations</h2>
<p>å…ˆè¡Œçš„ C++ ç‰ˆæœ¬ä¸­ï¼Œconcepts æ˜¯å¦‚æ­¤ä½¿ç”¨çš„ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Seq</span><span class="p">&gt;</span>
        <span class="n">requires</span> <span class="n">Sortable</span><span class="o">&lt;</span><span class="n">Seq</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="n">Seq</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
</code></pre></div></div>
<p>ç”¨ short-hand å†™æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="n">Sortable</span> <span class="n">Seq</span><span class="p">&gt;</span>
<span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="n">Seq</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
</code></pre></div></div>
<p>ä½†æ˜¯ä½œè€…å¸Œæœ›çš„æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="n">Sortable</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">);</span>
</code></pre></div></div>

<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ concepts çš„ä½¿ç”¨ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span> <span class="o">&lt;</span><span class="n">Sequence</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
      <span class="n">requires</span> <span class="n">Equality_comparable</span><span class="o">&lt;</span><span class="n">Value_type</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">Iterator_of</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span> <span class="n">find</span><span class="p">(</span><span class="n">S</span><span class="o">&amp;</span> <span class="n">seq</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>
</code></pre></div></div>
<p>è¿™é‡Œé¢æåˆ°äº†ä¸¤æ ·ä¸œè¥¿â€”â€”â€œrewrite ruleâ€ å’Œ â€œthe onion principleâ€ã€‚ç¬¬ä¸€ä¸ªï¼Œå°±æ˜¯ä¿—ç§°çš„è¯­æ³•ç³–äº†å§ï¼Œä½¿ç”¨æ›´ç®€å•çš„å½¢å¼å»å–ä»£ä¸€ç§æ›´å¤æ‚ä½†æ˜¯é€šç”¨çš„æ ¼å¼ï¼›ç¬¬äºŒä¸ªè§„åˆ™å°±å¦‚æ´‹è‘±ï¼Œæˆ‘ä»¬çš„è®¾è®¡åº”è¯¥ä¼˜å…ˆï¼ˆdefaultï¼‰è€ƒè™‘æœ€ç®€å•çš„å½¢å¼ï¼Œå¦‚æœæœ€ç®€å•çš„å½¢å¼ä¸èƒ½è¡¨ç¤ºï¼Œå°±åƒå‰¥å»æ´‹è‘±çš„ä¸€å±‚ä¸€æ ·ï¼Œå¯»æ‰¾è¾ƒä¸ºå¤æ‚ä½†æ›´é€šç”¨ä¸€ç‚¹çš„å†™æ³•ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å†å‰¥ä¸€å±‚ã€‚åŸæ–‡ç”šè‡³è®²äº†ä¸ªå†·ç¬‘è¯ï¼šEach layer gives you more flexibility, and make you cry more(because of the added work and the added opportunities for mistakes)ï¼Œè¿™ä¸ªåŒå…³è¯­çœŸæ˜¯ç»äº†ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢çš„ <code class="language-plaintext highlighter-rouge">Equality_comparable</code> å…¶å®å°±æ»¡è¶³è¿™æ ·çš„è§„å®šï¼šå› ä¸ºå¾ˆæ˜æ˜¾è¿™ç§åŒå‚æ•°çš„ concept ä¸èƒ½ä½¿ç”¨ short-handï¼Œè™½ç„¶æˆ‘ä»¬å¾ˆæƒ³ç”¨ï¼Œä½†æ˜¯æ²¡åŠæ³•ï¼Œåªèƒ½å†™åˆ° requires é‡Œé¢äº†ã€‚</p>

<h3 id="71-auto-arguments">7.1 <code class="language-plaintext highlighter-rouge">auto</code> arguments</h3>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="k">auto</span> <span class="n">x</span><span class="p">);</span>
</code></pre></div></div>
<p>è¿™ä¸ª <code class="language-plaintext highlighter-rouge">auto</code> ç®—æ˜¯ä¸€ä¸ªé™åˆ¶æœ€å°çš„ â€œconceptâ€ äº†ï¼ˆç»ˆäºçœ‹åˆ°ä¸€ä¸ªç¬¦åˆä½œè€…æƒ³æ³•çš„ concept äº†ï¼Œæ³ªç›®ï¼‰ï¼Œæ¢å¥è¯è¯´<em>æ‰€æœ‰</em>çš„ concepts éƒ½åº”è¯¥æ˜¯ <code class="language-plaintext highlighter-rouge">auto</code> çš„å­é›†ã€‚<code class="language-plaintext highlighter-rouge">auto</code> ä½œä¸ºå‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹çš„ææ¡ˆä½œè€…æ—©åœ¨ 01 å¹´å°±å‘èµ·äº†ï¼Œç»ˆäºç»ˆäºç»ˆäºï¼ŒC++14 åœ¨ lambdas ä¸­æ”¯æŒäº†ã€‚</p>

<p><strong>Tips:</strong><br />
C++11 å¼€å§‹å¼•å…¥çš„å‡½æ•°è¿”å›å€¼åç½®ï¼Œä½¿å¾—è‡ªåŠ¨æ¨å¯¼å‡½æ•°è¿”å›å€¼ç±»å‹æˆä¸ºå¯èƒ½ã€‚ä½†æ˜¯è¿™ä¸ªè‡ªåŠ¨çš„è¿‡ç¨‹éœ€è¦å†™æ‰‹åŠ¨çš„æ¨å¯¼ä»£ç ï¼ˆè¿·ä¹±ï¼‰ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">auto</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ç»è¿‡æµ‹è¯•ï¼Œg++ çš„ <code class="language-plaintext highlighter-rouge">-std=c++14</code> flag å°±å·²ç»æ”¯æŒä¸‹é¢çš„ä»£ç äº†ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">auto</span> <span class="nf">add</span><span class="p">(</span><span class="k">auto</span> <span class="n">a</span><span class="p">,</span> <span class="k">auto</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>åŠ ä¸Š flag <code class="language-plaintext highlighter-rouge">-fconcepts-ts</code> ç”šè‡³æ²¡æœ‰ warningã€‚è¿™éƒ¨åˆ†å±äº concepts TSï¼Œå…¶å®ä¹Ÿå°±ç›¸å½“äºæ˜¯ç§è´§ã€‚<br />
C++17 æ ‡å‡†ä¸‹çš„ clang++ æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡ä»¥ä¸Šçš„ä»£ç ï¼Œé‚£æ˜¯å› ä¸ºåœ¨ C++17 ä¸å¼€ TS çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯ä¸æ”¯æŒ concepts çš„ã€‚ä½†æ˜¯ï¼ŒC++20 ä¸‹ç¼–è¯‘å¯ä»¥é€šè¿‡ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåƒè¿™æ ·çš„ä¸œè¥¿ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">concept</span> <span class="kt">bool</span> <span class="n">Any</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">ff</span><span class="p">(</span><span class="k">auto</span> <span class="n">x</span><span class="p">,</span> <span class="k">auto</span> <span class="n">y</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">gg</span><span class="p">(</span><span class="n">Any</span> <span class="n">x</span><span class="p">,</span> <span class="n">Any</span> <span class="n">y</span><span class="p">);</span>
</code></pre></div></div>
<p>ç›¸è¾ƒ <code class="language-plaintext highlighter-rouge">ff()</code>ï¼Œ<code class="language-plaintext highlighter-rouge">gg()</code> çš„é™åˆ¶æ˜¯ä¸¤ä¸ªå‚æ•°ç±»å‹å¿…é¡»ç›¸åŒã€‚</p>

<h3 id="72-readability">7.2 Readability</h3>
<p>è¿™ä¸€éƒ¨åˆ†è·Ÿè¯­è¨€è®¾è®¡æœ‰å…³ç³»ï¼Œç¨å¾®æµè§ˆäº†ä¸€ä¸‹ã€‚ç¨å¾®æ€»ç»“ä¸€ä¸‹ï¼Œå°±ç›®å‰çš„ concepts åœ¨é˜…è¯»æ€§ä¸Šè¿˜æ˜¯å­˜åœ¨ä¸€äº›ç¼ºé™·çš„ï¼Œä¹Ÿæ˜¯äºŸé¡»ä¿®æ”¹çš„é—®é¢˜ï¼Œä½œè€…è®¤ä¸ºè¿™å…³ç³»åˆ° concepts çš„è®¾è®¡å’Œå¯ç»´æŠ¤æ€§ã€‚</p>

<h2 id="8-language-design-questions">8. Language design questions</h2>
<p>è¿™ä¸ªéƒ¨åˆ†æš‚æ—¶ä¸è¯»äº†ï¼Œè·Ÿç¨‹åºå‘˜å…³ç³»ä¸å¤§ã€‚ç­‰æ¥è§¦ language design ä¹‹æ—¶ï¼Œå°†ä¼šå†å›æ¥æ‹œè¯»ã€‚</p>
:ET