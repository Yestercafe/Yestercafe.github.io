I"ŠØ<p>åœ¨å†™è¿™ç¯‡ä¹‹å‰, éœ€è¦å¼ºè°ƒä¸€ä¸‹ä¹¦é‡Œä¹Ÿå¼ºè°ƒäº†çš„ä¸œè¥¿. å› ä¸ºä½¿ç”¨çš„ä¹¦æ˜¯17å¹´å‡ºç‰ˆçš„C++ Templatesç¬¬äºŒç‰ˆ, ä¹¦ä¸­å¤§é‡åœ°ä½¿ç”¨äº†C++14, C++17ç”šè‡³æ˜¯C++2a(ç›®å‰æ˜¯2a, ä¸ä¿è¯æˆ‘èƒ½åœ¨20å¹´C++20å‡ºæ¥ä¹‹å‰çœ‹å®Œ)æ ‡å‡†ä¸­çš„features. åœ¨æ­¤åˆ—ä¸¾ä¸€äº›å°†å¯èƒ½ä¼šä½¿ç”¨åˆ°çš„ç‰¹æ€§, ä½†ä¹Ÿä¸å±€é™äºæ­¤:</p>
<ul>
  <li>Variadic templates (C++11)</li>
  <li>å¯å˜æ¨¡æ¿</li>
  <li>Alias templates (C++11)</li>
  <li>æ¨¡æ¿åˆ«å</li>
  <li>Move semantics, rvalue references, and perfect forwarding (C++11)</li>
  <li>ç§»åŠ¨è¯­ä¹‰, å³å€¼å¼•ç”¨, å®Œç¾è½¬å‘</li>
  <li>Standard type traits (C++11)</li>
  <li>æ ‡å‡†åº“ä¸­çš„type_traits(ç±»å‹ç‰¹å¾)</li>
  <li>Variable templates (C++14)</li>
  <li>å˜é‡æ¨¡æ¿</li>
  <li>Generic Lambdas (C++14)</li>
  <li>é€šç”¨Lambdaè¡¨è¾¾å¼</li>
  <li>Class template argument deduction (C++17)</li>
  <li>ç±»æ¨¡æ¿å‚æ•°æ¨å¯¼</li>
  <li>Compile-time if (C++17)</li>
  <li>ç¼–è¯‘æœŸif</li>
  <li>Fold expressions (C++17)</li>
  <li>æŠ˜å è¡¨è¾¾å¼</li>
</ul>

<p>å› ä¸ºä¹‹å‰å†™çš„ä¸€äº›å†…å®¹æ¯”è¾ƒç´¯èµ˜, åŸºæœ¬å°±æ˜¯åœ¨ç¿»è¯‘å…¨ä¹¦äº†, æ‰€ä»¥æœ¬æ¬¡ä¼šå¤§å¹…åº¦å‡å°‘ç¯‡å¹….</p>

<h2 id="part-i-the-basics-åŸºç¡€çŸ¥è¯†">Part I. The Basics åŸºç¡€çŸ¥è¯†</h2>
<p>æœ¬éƒ¨åˆ†ä¸»è¦ä»‹ç»ä¸€äº›æ¨¡æ¿åŸºç¡€.</p>

<h2 id="chapter-1---function-templates-å‡½æ•°æ¨¡æ¿">Chapter 1 - Function Templates å‡½æ•°æ¨¡æ¿</h2>
<h3 id="defining-and-using-å£°æ˜å’Œä½¿ç”¨">Defining and Using å£°æ˜å’Œä½¿ç”¨</h3>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// if b &lt; a then yield a else yield b</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>è¿™æ ·çš„æ¨¡æ¿å®šä¹‰ä¼šæŒ‡å®šä¸€ä¸ªå®¶æ—çš„å‡½æ•°. æ¨¡æ¿å°±ä¸å¤šè§£é‡Šäº†, æ¯•ç«Ÿè¿™æœ¬ä¹¦çš„é‡ç‚¹ä¸æ˜¯åŸºç¡€çŸ¥è¯†.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span> <span class="n">comma</span><span class="o">-</span><span class="n">separated</span><span class="o">-</span><span class="n">list</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">parameters</span> <span class="p">&gt;</span>
</code></pre></div></div>
<p>æ¨¡æ¿å£°æ˜ä¸€èˆ¬æ ¼å¼.</p>

<p>å¼ºè°ƒå‡ ç‚¹:</p>
<ol>
  <li>æ¨¡æ¿å‚æ•°åˆ—è¡¨ä½¿ç”¨çš„æ˜¯angle brackets.</li>
  <li>C++å…³é”®å­—<code class="language-plaintext highlighter-rouge">typename</code>ç”¨äº<em>ç±»å‹å‚æ•°(type parameter)</em>çš„ç±»å‹.</li>
  <li>ä»£ç ä¸­å‡ºç°çš„<code class="language-plaintext highlighter-rouge">T</code>, ä»£è¡¨è¯¥å‡½æ•°è¢«è°ƒç”¨æ—¶ä½¿ç”¨ä½œä¸ºç±»ä¼¼å®é™…å‚æ•°(åé¢æåˆ°çš„æ‰€æœ‰æ¨¡æ¿è°ƒç”¨ä¸­çš„å®å‚å‡è¡¨ç¤ºåŒç­‰åœ°ä½çš„æ¨¡æ¿å‚æ•°)çš„ç±»å‹.</li>
  <li><code class="language-plaintext highlighter-rouge">T</code>ç±»å‹å¿…é¡»è¦æ”¯æŒ<code class="language-plaintext highlighter-rouge">operator&lt;</code>.</li>
  <li>å¹¶ä¸”<code class="language-plaintext highlighter-rouge">T</code>ç±»å‹è¿˜éœ€è¦æ”¯æŒæ‹·è´æ„é€ .</li>
  <li>è€æ ‡å‡†ç”¨çš„æ˜¯<code class="language-plaintext highlighter-rouge">class</code>å…³é”®å­—, <code class="language-plaintext highlighter-rouge">typename</code>æ˜¯è¿›åŒ–ç‰ˆæœ¬. åŸå› æ²¡æœ‰å¤šå¤æ‚, ä»…ä»…æ˜¯<code class="language-plaintext highlighter-rouge">class</code>è¿™ä¸ªè¯å®¹æ˜“äº§ç”Ÿè¯¯è§£è€Œå·², å› ä¸ºä»»ä½•ç±»å‹éƒ½å¯ä»¥ä½œä¸º<code class="language-plaintext highlighter-rouge">class</code>ç±»å‹çš„å®å‚.</li>
</ol>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "max1.hpp"
#include &lt;iostream&gt;
#include &lt;string&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"max(7,i): "</span> <span class="o">&lt;&lt;</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">f1</span> <span class="o">=</span> <span class="mf">3.4</span><span class="p">;</span> <span class="kt">double</span> <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">6.7</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"max(f1,f2): "</span> <span class="o">&lt;&lt;</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">"mathematics"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">"math"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"max(s1,s2): "</span> <span class="o">&lt;&lt;</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">Outputs:</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>max(7,i): 42
max(f1,f2): 3.4
max(s1,s2): mathematics
</code></pre></div></div>

<p><strong>ä¸è¦è½»æ˜“usingåç§°ç©ºé—´ä¸­çš„å†…å®¹!</strong> è¿™é‡Œçš„maxå‡½æ•°å°±é¢ä¸´è¿™æ ·ä¸€ä¸ªé—®é¢˜ â€“ maxåœ¨iostreamçš„stdåç§°ç©ºé—´ä¸‹æœ‰<strong>ç›¸åŒç­¾å</strong>çš„å®šä¹‰.</p>

<p>C++ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä¸åŒç±»å‹æ¨¡æ¿è°ƒç”¨ç”Ÿæˆä¸åŒå¥—çš„ä»£ç , æ¯”å¦‚ä¸Šé¢çš„intå‹æ•°æ®ä¼ è¿›å»å°±ä¼š<em>è‡ªåŠ¨ç”Ÿæˆ</em>:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">max</span> <span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>è¿™é‡Œçš„<em>è‡ªåŠ¨ç”Ÿæˆ</em>è¢«å«åš<strong>å®ä¾‹åŒ–(instantiation)</strong>, æ²¡é”™, å°±è·Ÿç±»å®ä¾‹åŒ–é‚£ä¸ªä¸€ä¸ªåå­—, æ‰€ä»¥ä¹ æƒ¯è¿˜æ˜¯å«<em>æ¨¡æ¿å®ä¾‹åŒ–</em>. è¿™æ ·ä¸€æ®µç”Ÿæˆä»£ç , åŒæ ·, è¢«å«åšæ¨¡æ¿çš„<strong>å®ä¾‹(instance)</strong>.</p>

<p>æ¯æ¬¡å¯¹å‡½æ•°æ¨¡æ¿çš„ä½¿ç”¨ä¼šè‡ªåŠ¨è§¦å‘è¿™æ ·çš„å®ä¾‹åŒ–è¿‡ç¨‹.</p>

<p>æ³¨æ„, <code class="language-plaintext highlighter-rouge">void</code>ä¹Ÿæ˜¯ä¸€ä¸ªåˆæ³•çš„æ¨¡æ¿å‚æ•°, for example:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">foo</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span><span class="o">*</span> <span class="n">vp</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
<span class="n">foo</span><span class="p">(</span><span class="n">vp</span><span class="p">);</span>  <span class="c1">// OK: deduces void</span>
<span class="n">foo</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="two-phase-translation-äºŒç›¸ç¿»è¯‘-åŒé˜¶æ®µç¿»è¯‘">Two-Phase Translation äºŒç›¸ç¿»è¯‘, åŒé˜¶æ®µç¿»è¯‘</h3>
<p>æ¨¡æ¿å®ä¾‹åŒ–ä»£ç çš„ç¼–è¯‘æ˜¯æœ‰ä¸€ä¸ªå°è¯•è¿‡ç¨‹çš„. æ•´ä¸ªæ¨¡æ¿å®ä¾‹åŒ–â€ç¼–è¯‘â€è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ:</p>
<ol>
  <li>åœ¨<em>definition time</em>ä¸è¿›è¡Œå®ä¾‹åŒ–. æ¨¡æ¿ä»£ç éœ€è¦å…ˆå¿½ç•¥æ¨¡æ¿å‚æ•°å…ˆæ£€æŸ¥è‡ªèº«çš„çš„é”™è¯¯, æ¯”å¦‚: å°‘äº†ä¸ªé€—å·åˆ†å·ä¹‹ç±»çš„è¯­æ³•é”™è¯¯\ç”¨äº†æ²¡æœ‰å£°æ˜çš„æ ‡è¯†ç¬¦\é™æ€æ–­è¨€æ–­ç‚¸äº†.</li>
  <li>åœ¨<em>instantiation time</em>è¿›è¡Œå®ä¾‹åŒ–. æŠŠæ¨¡æ¿å‚æ•°çš„ç±»å‹ä»£å…¥ä»£ç å†æ¬¡æ£€æŸ¥æ‰€æœ‰çš„é”™è¯¯.</li>
</ol>

<p>for example:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="n">T</span> <span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">undeclared</span><span class="p">();</span>  <span class="c1">// ç¬¬ä¸€é˜¶æ®µç‚¸</span>
    <span class="n">undeclared</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>  <span class="c1">// ç¬¬äºŒé˜¶æ®µç‚¸</span>
    <span class="k">static_assert</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="s">"int too small"</span><span class="p">);</span>  <span class="c1">// ç¬¬ä¸€é˜¶æ®µç‚¸, å› ä¸ºå¥½åƒè¿˜æ²¡æœ‰å“ªä¸ªç¼–è¯‘å™¨intå‹sizeä¼šè¶…è¿‡10çš„</span>
    <span class="k">static_assert</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="s">"T too small"</span><span class="p">);</span>  <span class="c1">// ç¬¬äºŒé˜¶æ®µå¯èƒ½ä¼šç‚¸, è¿™è¦çœ‹Tç±»å‹æœ‰å¤šå¤§äº†</span>
<span class="p">}</span>
</code></pre></div></div>
<p>å¾ˆåé¢è¿˜ä¼šæœ‰ä¸€ä¸ªå«<em>two-phase lookup</em>çš„ä¸œè¥¿, æ‰€ä»¥ä¸æ€¥.</p>

<h3 id="compiling-and-linking-ç¼–è¯‘å’Œé“¾æ¥">Compiling and Linking ç¼–è¯‘å’Œé“¾æ¥</h3>
<p>åé¢å¥½åƒè¿˜æœ‰ä¸“é—¨è®²çš„, è¿™é‡Œåªå¼ºè°ƒä¸€ç‚¹:<br />
<strong>å‡½æ•°æ¨¡æ¿çš„å®šä¹‰å’Œå£°æ˜éƒ½æ”¾åœ¨å¤´æ–‡ä»¶é‡Œ, å†™åœ¨ä¸€èµ·, åˆ†æ–‡ä»¶å†™ä¼šæŠ¥é“¾æ¥é”™è¯¯.</strong></p>

<h3 id="template-argument-deduction-æ¨¡æ¿å‚æ•°æ¨å¯¼">Template Argument Deduction æ¨¡æ¿å‚æ•°æ¨å¯¼</h3>
<p>è¿™ç©æ„ç¼–è¯‘å™¨å†™å¾—å¾ˆæ™ºèƒ½, ä¸ç”¨è€ƒè™‘é‚£ä¹ˆå¤šçš„. æ¯”å¦‚:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ä¼ <code class="language-plaintext highlighter-rouge">int</code>å˜é‡è¿›å», <code class="language-plaintext highlighter-rouge">T</code>ä¼šè‡ªåŠ¨æ¨å¯¼æˆ<code class="language-plaintext highlighter-rouge">int</code>, å› ä¸ºä¼ è¿›å»çš„å®å‚ç±»å‹èƒ½ä¸<code class="language-plaintext highlighter-rouge">int const&amp;</code>åŒ¹é….</p>

<p>ä½†æ˜¯, <em>è‡ªåŠ¨ç±»å‹è½¬æ¢</em>åœ¨ç±»å‹æ¨å¯¼æ—¶è¢«<strong>ä¸¥æ ¼é™åˆ¶</strong>äº†:</p>
<ul>
  <li>è°ƒç”¨å‡½æ•°æ—¶, å‚æ•°ä½¿ç”¨å¼•ç”¨ä¼ é€’, ä»»ä½•è‡ªåŠ¨ç±»å‹è½¬æ¢éƒ½ä¸èƒ½æ­£å¸¸è¿›è¡Œ. ç®€å•è¯´å°±æ˜¯æ‰€æœ‰çš„<code class="language-plaintext highlighter-rouge">T</code>ç±»å‹å¿…é¡»è¦å…¨éƒ¨ç²¾å‡†çš„ä¸€æ¨¡ä¸€æ ·æ‰èƒ½æ­£å¸¸æ¨å¯¼.</li>
  <li>è°ƒç”¨å‡½æ•°æ—¶, å‚æ•°ä½¿ç”¨å€¼ä¼ é€’, ç±»å‹ä¼šåœ¨<em>æ¶ˆå»é™åˆ¶ç±»ç±»å‹ä¿®é¥°ç¬¦(decay)</em>åæ£€æŸ¥åŒ¹é…. è¿™ä¸ªå•è¯æ˜¯æˆ‘ä¹±ç¿»è¯‘çš„, è§£é‡Šä¸€ä¸‹å°±æ˜¯: constæˆ–volatileè¢«å¿½ç•¥\å¼•ç”¨è½¬æ¢ä¸ºè¢«å¼•ç”¨çš„ç±»å‹, æ¯”å¦‚int&amp;è½¬æ¢ä¸ºint\åŸç”Ÿæ•°ç»„æˆ–è€…å‡½æ•°è½¬æ¢ä½å¯¹åº”çš„æŒ‡é’ˆç±»å‹. ç®€è€Œè¨€ä¹‹å°±æ˜¯æ‰€æœ‰çš„<code class="language-plaintext highlighter-rouge">T</code>åœ¨<em>decay</em>ä¹‹åç±»å‹è¦ä¸€æ¨¡ä¸€æ ·æ‰èƒ½æ­£å¸¸æ¨å¯¼.</li>
</ul>

<p>æ¯”å¦‚:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">);</span>
<span class="p">...</span>
<span class="kt">int</span> <span class="k">const</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="n">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>  <span class="c1">// OK: T is deduced as int</span>
<span class="n">max</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>  <span class="c1">// OK: T is deduced as int</span>
<span class="kt">int</span><span class="o">&amp;</span> <span class="n">ir</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="n">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ir</span><span class="p">);</span>  <span class="c1">// OK: T is deduced as int</span>
<span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="n">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="n">arr</span><span class="p">);</span>  <span class="c1">// OK: T is deduced as int*</span>
</code></pre></div></div>
<p>åˆæ¯”å¦‚åä¾‹:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">);</span>   <span class="c1">// ERROR: T can be deduced as int or double</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
<span class="n">foo</span><span class="p">(</span><span class="s">"hello"</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>  <span class="c1">//ERROR: T can be deduced as char const[6] or std::string</span>
</code></pre></div></div>

<p>å¥½äº†, è§£å†³åˆšæ‰ç¬¬ä¸€ä¸ªERRORçš„æ–¹æ³•æœ‰ä¸‰ç§, ç®€å•è¯´æ˜ä¸€ä¸‹:</p>
<ol>
  <li>æ‰‹åŠ¨åŠ ä¸ªè½¬æ¢:
    <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">max</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mf">7.2</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>åˆ«è®©ç¼–è¯‘å™¨è‡ªåŠ¨æ¨å¯¼:
    <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">max</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>åœ¨å†™maxçš„æ—¶å€™å¼„ä¸¤ä¸ªæ¨¡æ¿å‚æ•°. å‚è€ƒä¸‹é¢çš„â€å¤šæ¨¡æ¿å‚æ•°â€èŠ‚.</li>
</ol>

<p>å…³äºé»˜è®¤å‚æ•°çš„é—®é¢˜, éœ€è¦æä¸€ä¸‹:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="n">T</span> <span class="o">=</span> <span class="s">""</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">f</span><span class="p">();</span>
</code></pre></div></div>
<p>ä¸Šé¢è¿™ç§ç•™é»˜è®¤å‚æ•°çš„æ–¹å¼æ˜¯æ¨å¯¼ä¸å‡º<code class="language-plaintext highlighter-rouge">T</code>çš„ç±»å‹çš„, éœ€è¦æ‰‹åŠ¨æŒ‡å®š:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">&gt;</span>
<span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="n">T</span> <span class="o">=</span> <span class="s">""</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">f</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="multiple-template-parameters-å¤šæ¨¡æ¿å‚æ•°">Multiple Template Parameters å¤šæ¨¡æ¿å‚æ•°</h3>
<p>ç›´æ¥ä¸Šä»£ç .</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
<span class="n">T1</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="k">auto</span> <span class="n">m</span> <span class="o">=</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">);</span>
</code></pre></div></div>
<p>è¿™é‡Œçš„<code class="language-plaintext highlighter-rouge">auto</code>ä¼šè¢«æ¨å¯¼æˆ<code class="language-plaintext highlighter-rouge">T1</code>çš„é‚£ä¸ªç±»å‹, <code class="language-plaintext highlighter-rouge">T1</code>åœ¨æ¨¡æ¿å®ä¾‹åŒ–è¢«æ¨å¯¼æˆå®å‚<code class="language-plaintext highlighter-rouge">a</code>çš„ç±»å‹, å®å‚<code class="language-plaintext highlighter-rouge">a</code>æ˜¯å­—é¢å€¼<code class="language-plaintext highlighter-rouge">4</code>, æ‰€ä»¥ç±»å‹è‡ªç„¶æ˜¯<code class="language-plaintext highlighter-rouge">const int</code>, åœ¨æ ¹æ®åˆšæ‰çš„é‚£ä¸ªè‡ªåŠ¨ç±»å‹æ¨å¯¼çš„æ–¹æ¡ˆ, <code class="language-plaintext highlighter-rouge">T1</code>ä¼šè¢«æ¨å¯¼æˆ<code class="language-plaintext highlighter-rouge">int</code>å‹, æ‰€ä»¥<code class="language-plaintext highlighter-rouge">m</code>ä¼šæ˜¯<code class="language-plaintext highlighter-rouge">int</code>å‹çš„.</p>

<p>ä½†æ˜¯ä»”ç»†æƒ³ä¸€æƒ³è¿˜æ˜¯æŒºç³Ÿç³•çš„, å› ä¸º<code class="language-plaintext highlighter-rouge">T1</code>å’Œ<code class="language-plaintext highlighter-rouge">T2</code>åœ¨ç¼–è¯‘æœŸä¹‹å‰å¹¶ä¸ä¼šçŸ¥é“è°æ˜¯è°çš„ä¸Šä½ç±»å‹, ç”šè‡³è¿™ä¸¤ä¸ªç±»å‹éƒ½ä¸èƒ½è¿›è¡Œå•å‘è½¬æ¢. äºæ˜¯è¿™é‡Œéœ€è¦é‡‡å–ä¸€äº›ç­–ç•¥è§£å†³è¿”å›å€¼ç±»å‹çš„é—®é¢˜.</p>

<h4 id="template-parameters-for-return-types-ç”¨æ¨¡æ¿å‚æ•°ä½œä¸ºè¿”å›å€¼ç±»å‹">Template Parameters for Return Types ç”¨æ¨¡æ¿å‚æ•°ä½œä¸ºè¿”å›å€¼ç±»å‹</h4>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">RT</span><span class="p">&gt;</span>
<span class="n">RT</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">);</span>
<span class="p">...</span>
<span class="o">::</span><span class="n">max</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">);</span>
</code></pre></div></div>
<p>æ‰‹åŠ¨æŒ‡å®š<code class="language-plaintext highlighter-rouge">RT</code>è¿”å›å€¼ç±»å‹, æˆ–è€…, å¯ä»¥è®©ç¼–è¯‘å™¨æ¨å¯¼éƒ¨åˆ†å®ƒå¯ä»¥æ¨å¯¼çš„ç±»å‹:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">RT</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
<span class="n">RT</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">);</span>
<span class="p">...</span>
<span class="o">::</span><span class="n">max</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">);</span>
</code></pre></div></div>
<h4 id="deducing-the-return-type-æ¨å¯¼è¿”å›å€¼ç±»å‹">Deducing the Return Type æ¨å¯¼è¿”å›å€¼ç±»å‹</h4>
<p>è¿™å—çœŸçš„å‡ºç°äº†å¾ˆå¤šçš„æ¨å¯¼, è¿™ä¸ªèŠ‚æ ‡é¢˜ä¸­çš„æ¨å¯¼æ˜¯<code class="language-plaintext highlighter-rouge">auto</code>å…³é”®å­—çš„ç±»å‹æ¨å¯¼.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
<span class="k">auto</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">auto</code>å…³é”®å­—ä½œä¸ºå‡½æ•°è¿”å›å€¼ç›´æ¥å†™åœ¨å‡½æ•°åå‰é¢çš„è¿™ç§, æ˜¯C++14çš„ç‰¹æ€§. ä¹‹åæˆ‘ä¼šæ¸æ¸å¼±åŒ–â€æŸæŸæ˜¯C++1xæ ‡å‡†çš„ç‰¹æ€§â€çš„æ¦‚å¿µ, åæ­£æˆ‘ä»¬éƒ½æ˜¯ç›´æ¥<code class="language-plaintext highlighter-rouge">-std=c++2a</code>, ç›®çš„æ˜¯ä¸ºäº†ç ”ç©¶C++çš„é«˜é˜¶ç”¨æ³•, <strong>è€Œä¸æ˜¯</strong>ç ”ç©¶æŸä¸€ä¸ªç‰ˆæœ¬çš„æ ‡å‡†.</p>

<p>C++11çš„ç‰ˆæœ¬å†™èµ·æ¥è¦å¤æ‚ä¸€ç‚¹ç‚¹, å› ä¸º11æ—¶ä»£è¿˜ä¸æ”¯æŒå‡½æ•°ä»<code class="language-plaintext highlighter-rouge">return</code>è¯­å¥ä¸­ç›´æ¥æ¨å¯¼è¿”å›å€¼ç±»å‹, éœ€è¦ä¸€ä¸ª<em>åç½®è¿”å›å€¼ç±»å‹ä¾¦æµ‹</em>(è¿™ä¸œè¥¿åŸæ–‡å«åš<em>a corresponding trailing return
type (which would be introduced with a -&gt; at the end)</em>)</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// C++11</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
<span class="k">auto</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">b</span><span class="o">&lt;</span><span class="n">a</span><span class="o">?</span><span class="n">a</span><span class="o">:</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>è¿™é‡Œå…¶å®å¯ä»¥é‡‡å–ç®€åŒ–çš„å†™æ³•, æŠŠ<code class="language-plaintext highlighter-rouge">b&lt;a</code>æ”¹ç§°<code class="language-plaintext highlighter-rouge">true</code>ä¹Ÿè¿˜æ˜¯å¯ä»¥æ¨å¯¼å‡º<code class="language-plaintext highlighter-rouge">a</code>å’Œ<code class="language-plaintext highlighter-rouge">b</code>çš„ä¸Šä½ç±»å‹.</p>

<p>ä½†æ˜¯åœ¨æœ‰äº›æƒ…å†µä¸‹, <code class="language-plaintext highlighter-rouge">T</code>å¿…é¡»æ˜¯å¼•ç”¨ç±»å‹, è¿™æ—¶çš„è¿”å›å€¼å¯èƒ½éœ€è¦ä¸€äº›ç»†å¾®çš„è°ƒæ•´:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;type_traits&gt;
</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
<span class="k">auto</span> <span class="n">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">decay</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="nb">true</span><span class="o">?</span>
<span class="n">a</span><span class="o">:</span><span class="n">b</span><span class="p">)</span><span class="o">&gt;::</span><span class="n">type</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">std::decay</code>æ˜¯<code class="language-plaintext highlighter-rouge">type_traits</code>ä¸­æä¾›çš„ä½¿ç”¨C++å…ƒèƒ½åŠ›ç¼–å†™å‡ºæ¥çš„â€ç»“æ„ä½“â€, å½“ç„¶è¿™ç©æ„å„¿æ˜¯ç»“æ„ä½“åªæ˜¯ä¸€ä¸ªå¹Œå­äº†.</p>

<h4 id="return-type-as-common-type-ä»¥common_type_tç±»å‹è¿”å›">Return Type as Common Type ä»¥common_type_tç±»å‹è¿”å›</h4>
<p>é¡¾åæ€ä¹‰, ç›´æ¥ä¸Šä»£ç :</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;type_traits&gt;
</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
<span class="n">std</span><span class="o">::</span><span class="n">common_type_t</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span><span class="n">T2</span><span class="o">&gt;</span> <span class="n">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>è™½ç„¶è¯´å¥½ä¸æC++1xçš„ç‰¹æ€§, ä½†æ˜¯ç‚¹åæ‰¹è¯„C++11. è™½ç„¶C++11ç®—æ˜¯Modern C++çš„ä¸€ä¸ªå¥½çš„å¼€å§‹, ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸å°‘ç‰¹æ€§ä¸Šçš„â€bugâ€åœ¨åæœŸçš„ç‰ˆæœ¬æ‰æœ‰ä¿®å¤. ä»¥ä¸Šçš„ç‰ˆæœ¬åªé€‚ç”¨äºC++14ä»¥åçš„ç‰ˆæœ¬, C++11çš„ç‰ˆæœ¬:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;type_traits&gt;
</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
<span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">common_type</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span><span class="n">T2</span><span class="o">&gt;::</span><span class="n">type</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="default-template-arguments-é»˜è®¤æ¨¡æ¿å‚æ•°">Default Template Arguments é»˜è®¤æ¨¡æ¿å‚æ•°</h3>
<p>åˆšæ‰çš„æœ‰ä¸€ä¸ªä»£ç é‡Œå·²ç»å‡ºç°è¿‡äº†çš„, ç±»ä¼¼äºå‡½æ•°çš„é»˜è®¤å‚æ•°, å‡½æ•°æ¨¡æ¿ä¹Ÿå¯ä»¥æŒ‡å®šæ¨¡æ¿å‚æ•°çš„é»˜è®¤å€¼.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;type_traits&gt;
</span><span class="k">template</span><span class="o">&lt;</span>
    <span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> 
    <span class="k">typename</span> <span class="nc">T2</span><span class="p">,</span> 
    <span class="k">typename</span> <span class="nc">RT</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">decay_t</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="nb">true</span> <span class="o">?</span> <span class="n">T1</span><span class="p">()</span> <span class="o">:</span> <span class="n">T2</span><span class="p">())&gt;</span>
<span class="o">&gt;</span>
<span class="n">RT</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ç¨å¾®æŠŠåŸä¹¦çš„ä»£ç æŒ‰ç…§æ ‡å‡†æ–‡æ¡£ä¸Šçš„æ ‡å‡†é‡æ–°æ’ç‰ˆäº†ä¸€ä¸‹.<br />
ä»£ç æ¯”è¾ƒç®€å•ä¹Ÿå°±ä¸è§£é‡Šäº†. éœ€è¦æ³¨æ„çš„æ˜¯, ä¸Šé¢çš„è¿™ä¸ªä»£ç è°ƒç”¨äº†<code class="language-plaintext highlighter-rouge">T1</code>å’Œ<code class="language-plaintext highlighter-rouge">T2</code>çš„é»˜è®¤æ„é€ å™¨.<br />
ä¸‹é¢å†ç»™å‡ºä½¿ç”¨<code class="language-plaintext highlighter-rouge">common_type</code>çš„ç‰ˆæœ¬:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;type_traits&gt;
</span><span class="k">template</span><span class="o">&lt;</span>
    <span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> 
    <span class="k">typename</span> <span class="nc">T2</span><span class="p">,</span>
    <span class="k">typename</span> <span class="nc">RT</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">common_type_t</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">&gt;</span>
<span class="o">&gt;</span>
<span class="n">RT</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="overloading-function-templates-é‡è½½å‡½æ•°æ¨¡æ¿">Overloading Function Templates é‡è½½å‡½æ•°æ¨¡æ¿</h3>
<p>æƒ³å¸¸è§„çš„å‡½æ•°ä¸€æ ·, å‡½æ•°æ¨¡æ¿ä¹Ÿæ”¯æŒé‡è½½, å¹¶ä¸”C++ç¼–è¯‘å™¨ä¼šå¸®åŠ©å†³å®šåˆ°åº•åº”è¯¥ä½¿ç”¨å‡½æ•°çš„å“ªä¸€ä¸ªç‰ˆæœ¬. ä½†å®é™…ç¼–è¯‘å™¨å®ç°è¿™ä¸ªåŠŸèƒ½çš„æ–¹æ³•æ˜¯éå¸¸å¤æ‚çš„, è¿™é‡Œä¸åšè®¨è®º.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">max</span> <span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>  <span class="c1">// calls the nontemplate for two ints</span>
    <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">);</span>  <span class="c1">// calls max&lt;double&gt; (by argument deduction)</span>
    <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="sc">'a'</span><span class="p">,</span> <span class="sc">'b'</span><span class="p">);</span>  <span class="c1">// calls max&lt;char&gt; (by argument deduction)</span>
    <span class="o">::</span><span class="n">max</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>  <span class="c1">// calls max&lt;int&gt; (by argument deduction)</span>
    <span class="o">::</span><span class="n">max</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>  <span class="c1">// // calls max&lt;double&gt; (no argument deduction)</span>
    <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="sc">'a'</span><span class="p">,</span> <span class="mf">42.7</span><span class="p">);</span>  <span class="c1">// //calls the nontemplate for two ints</span>
<span class="p">}</span>
</code></pre></div></div>

<p>éœ€è¦ç‰¹åˆ«æå‡ºçš„åªæœ‰ä¸¤ä¸ªè°ƒç”¨, ä¸€ä¸ªæ˜¯<code class="language-plaintext highlighter-rouge">::max&lt;&gt;(7, 42)</code>, è¿™ä¸ªå¾ˆæ˜æ˜¾, æ˜¯æœ‰æ„è°ƒç”¨å¸¦æ¨¡æ¿çš„ç‰ˆæœ¬çš„; ä¸€ä¸ªæ˜¯<code class="language-plaintext highlighter-rouge">::max('a', 42.7)</code>, å› ä¸ºæ¨¡æ¿å‚æ•°ä¸æ”¯æŒè‡ªåŠ¨ç±»å‹è½¬æ¢, æ‰€ä»¥è°ƒç”¨çš„æ˜¯<code class="language-plaintext highlighter-rouge">int (int, int)</code>çš„ç‰ˆæœ¬.</p>

<p>æ¥ä¸‹æ¥, è®¨è®ºä¸¤ç§æ¨å¯¼ä¹‹é—´çš„PK:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
<span class="k">auto</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">RT</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
<span class="n">RT</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>è¿™ä¸ªä¸»è¦è¿˜æ˜¯ä¼šæ ¹æ®æŒ‡å®šçš„æ¨¡æ¿å‚æ•°æ¥å®š:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">auto</span> <span class="n">a</span> <span class="o">=</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">);</span>  <span class="c1">// uses first template</span>
<span class="k">auto</span> <span class="n">b</span> <span class="o">=</span> <span class="o">::</span><span class="n">max</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">7.2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>  <span class="c1">// uses second template</span>
<span class="k">auto</span> <span class="n">c</span> <span class="o">=</span> <span class="o">::</span><span class="n">max</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">);</span>  <span class="c1">// ERROR: both function templates match</span>
</code></pre></div></div>
<p>åŸæ–‡ä½¿ç”¨äº†æˆ‘éå¸¸å–œæ¬¢çš„ä¸€ä¸ªè¯, ambiguity, Both templates match, which causes the overload resolution process normally to prefer none and result in an ambiguity error.</p>

<p>æ¥ç€è®¨è®ºCé£æ ¼å­—ç¬¦ä¸²å’ŒæŒ‡é’ˆä¹‹é—´çš„é—®é¢˜.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;cstring&gt;
#include &lt;string&gt;
</span>
<span class="c1">// maximum of two values of any type:</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// maximum of two pointers:</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span><span class="o">*</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="o">*</span><span class="n">b</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// maximum of two C-strings:</span>
<span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="nf">max</span> <span class="p">(</span><span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">strcmp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">m1</span> <span class="o">=</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>  <span class="c1">// max() for two values of type int</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">"hey"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">"you"</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">m2</span> <span class="o">=</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">);</span>  <span class="c1">// max() for two values of type std::string</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">p1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">;</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">p2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">m3</span> <span class="o">=</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">);</span> <span class="c1">// max() for two pointers</span>
    <span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">x</span> <span class="o">=</span> <span class="s">"hello"</span><span class="p">;</span>
    <span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">y</span> <span class="o">=</span> <span class="s">"world"</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">m4</span> <span class="o">=</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>  <span class="c1">// max() for two C-strings</span>
<span class="p">}</span>
</code></pre></div></div>
<p>æ³¨æ„, æ‰€æœ‰<code class="language-plaintext highlighter-rouge">max</code>çš„é‡è½½éƒ½æ˜¯å€¼ä¼ é€’.<br />
åœ¨å¸¸è§„æƒ…å†µä¸‹, åº”è¯¥å°½é‡ä¸åœ¨ä¸å¿…è¦é‡è½½å‡½æ•°æ¨¡æ¿çš„æ—¶å€™åšæ›´å¤šçš„æ›´æ”¹, ç®€å•ç‚¹è®²å°±æ˜¯å°½é‡ä¸è¦ç”¨æ¨¡æ¿ç”Ÿäº§å‡ºæ›´å¤šçš„å‡½æ•°é‡è½½. å¦åˆ™, å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›å¥‡æ€ªçš„é—®é¢˜. æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µ, æˆ‘å…ˆç¨å¾®ç ”ç©¶ä¸€ä¸‹, ç­‰ä¸‹å†è¯´:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;cstring&gt;
</span>
<span class="c1">// maximum of two values of any type (call-by-reference)</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">max</span> <span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// maximum of two C-strings (call-by-value)</span>
<span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="nf">max</span> <span class="p">(</span><span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">strcmp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// maximum of three values of any type (call-by-reference)</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">max</span> <span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">,</span> <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">max</span> <span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">);</span> <span class="c1">// error if max(a,b) uses call-by-value</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">m1</span> <span class="o">=</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">68</span><span class="p">);</span>  <span class="c1">// OK</span>
    <span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">"frederic"</span><span class="p">;</span>
    <span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">"anica"</span><span class="p">;</span>
    <span class="kt">char</span> <span class="k">const</span><span class="o">*</span> <span class="n">s3</span> <span class="o">=</span> <span class="s">"lucas"</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">m2</span> <span class="o">=</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">);</span>  <span class="c1">//run-time ERROR</span>
<span class="p">}</span>
</code></pre></div></div>
<p>è¿™ä¸ªä»£ç é”™è¯¯æœ€æ¶å¿ƒçš„åœ°æ–¹æ˜¯, ä»–ä¼šæŠ¥ä¸€ä¸ªrun-time error, è€Œä¸æ˜¯ç¼–è¯‘é”™è¯¯. åŸå› æ˜¯, åœ¨Cé£æ ¼å­—ç¬¦ä¸²ä½œä¸ºå®å‚è°ƒç”¨<code class="language-plaintext highlighter-rouge">max(a, b)</code>çš„æ—¶å€™, åˆ›é€ äº†ä¸€ä¸ªå…¨æ–°çš„ä¸´æ—¶<em>å±€éƒ¨</em>å€¼, å¹¶ä½œä¸ºå¼•ç”¨è¿”å›, ä½†æ˜¯æ˜¾ç„¶è¿™ä¸ªå¼•ç”¨å¼•ç”¨çš„åŸä¸´æ—¶å˜é‡, ä¼šåœ¨å‡½æ•°è¿”å›åè¢«é”€æ¯, æœ€ç»ˆå˜æˆäº†ä¸€ä¸ª<em>æ— æ•ˆå¼•ç”¨(dangling reference)</em>.</p>

<p>å…¶å®è¿™æ®µè¯æˆ‘æ˜¯æ²¡æ€ä¹ˆè¯»æ‡‚çš„. è¿™é‡Œå‚è€ƒäº†ä¸€ä¸‹ç”±objdumpè§£æå‡ºæ¥çš„æ±‡ç¼–ä»£ç :</p>
<pre><code class="language-x86asm">0000000000401159 &lt;main&gt;:
  401159:	55                   	push   %rbp
  40115a:	48 89 e5             	mov    %rsp,%rbp
  40115d:	48 83 ec 40          	sub    $0x40,%rsp
  401161:	c7 45 e4 44 00 00 00 	movl   $0x44,-0x1c(%rbp)
  401168:	c7 45 e8 2a 00 00 00 	movl   $0x2a,-0x18(%rbp)
  40116f:	c7 45 ec 07 00 00 00 	movl   $0x7,-0x14(%rbp)
  401176:	48 8d 55 e4          	lea    -0x1c(%rbp),%rdx
  40117a:	48 8d 4d e8          	lea    -0x18(%rbp),%rcx
  40117e:	48 8d 45 ec          	lea    -0x14(%rbp),%rax
  401182:	48 89 ce             	mov    %rcx,%rsi
  401185:	48 89 c7             	mov    %rax,%rdi
  401188:	e8 42 00 00 00       	callq  4011cf &lt;_Z3maxIiERKT_S2_S2_S2_&gt;
  40118d:	8b 00                	mov    (%rax),%eax
  40118f:	89 45 fc             	mov    %eax,-0x4(%rbp)
  401192:	48 c7 45 d8 10 20 40 	movq   $0x402010,-0x28(%rbp)
  401199:	00 
  40119a:	48 c7 45 d0 19 20 40 	movq   $0x402019,-0x30(%rbp)
  4011a1:	00 
  4011a2:	48 c7 45 c8 1f 20 40 	movq   $0x40201f,-0x38(%rbp)
  4011a9:	00 
  4011aa:	48 8d 55 c8          	lea    -0x38(%rbp),%rdx
  4011ae:	48 8d 4d d0          	lea    -0x30(%rbp),%rcx
  4011b2:	48 8d 45 d8          	lea    -0x28(%rbp),%rax
  4011b6:	48 89 ce             	mov    %rcx,%rsi
  4011b9:	48 89 c7             	mov    %rax,%rdi
  4011bc:	e8 49 00 00 00       	callq  40120a &lt;_Z3maxIPKcERKT_S4_S4_S4_&gt;
  4011c1:	48 8b 00             	mov    (%rax),%rax
  4011c4:	48 89 45 f0          	mov    %rax,-0x10(%rbp)
  4011c8:	b8 00 00 00 00       	mov    $0x0,%eax
  4011cd:	c9                   	leaveq 
  4011ce:	c3                   	retq

000000000040120a &lt;_Z3maxIPKcERKT_S4_S4_S4_&gt;:
  40120a:	55                   	push   %rbp
  40120b:	48 89 e5             	mov    %rsp,%rbp
  40120e:	53                   	push   %rbx
  40120f:	48 83 ec 38          	sub    $0x38,%rsp
  401213:	48 89 7d d8          	mov    %rdi,-0x28(%rbp)
  401217:	48 89 75 d0          	mov    %rsi,-0x30(%rbp)
  40121b:	48 89 55 c8          	mov    %rdx,-0x38(%rbp)
  40121f:	48 8b 45 c8          	mov    -0x38(%rbp),%rax
  401223:	48 8b 18             	mov    (%rax),%rbx
  401226:	48 8b 45 d0          	mov    -0x30(%rbp),%rax
  40122a:	48 8b 10             	mov    (%rax),%rdx
  40122d:	48 8b 45 d8          	mov    -0x28(%rbp),%rax
  401231:	48 8b 00             	mov    (%rax),%rax
  401234:	48 89 d6             	mov    %rdx,%rsi
  401237:	48 89 c7             	mov    %rax,%rdi
  40123a:	e8 e7 fe ff ff       	callq  401126 &lt;_Z3maxPKcS0_&gt;
  40123f:	48 89 de             	mov    %rbx,%rsi
  401242:	48 89 c7             	mov    %rax,%rdi
  401245:	e8 dc fe ff ff       	callq  401126 &lt;_Z3maxPKcS0_&gt;
  40124a:	48 89 45 e8          	mov    %rax,-0x18(%rbp)
  40124e:	b8 00 00 00 00       	mov    $0x0,%eax
  401253:	48 83 c4 38          	add    $0x38,%rsp
  401257:	5b                   	pop    %rbx
  401258:	5d                   	pop    %rbp
  401259:	c3                   	retq
</code></pre>
<p>æ‹·è´çš„æœ‰ç‚¹å¤š, ä¸»è¦æ˜¯ä¸çŸ¥é“è¦æ€ä¹ˆè£å‡. ä¸»è¦ç›¯ç€callqæŒ‡ä»¤è°ƒç”¨åœ°å€åé¢çš„tagå°±è¡Œäº†.</p>

<p>ä¸»å‡½æ•°ç¬¬äºŒæ¬¡callqçš„å‡½æ•°æ˜¯<code class="language-plaintext highlighter-rouge">_Z3maxIPKcERKT_S4_S4_S4_</code>, è¿™å¾ˆæ­£å¸¸, åŒºåˆ«æ˜¯<code class="language-plaintext highlighter-rouge">S2</code>çš„<code class="language-plaintext highlighter-rouge">int</code>å‹, ä½†æ˜¯ä»è¿™é‡Œå¹¶æ— æ³•ç¡®å®š<code class="language-plaintext highlighter-rouge">S4</code>ç©¶ç«Ÿæ˜¯ä»€ä¹ˆç±»å‹. è¿›å…¥<code class="language-plaintext highlighter-rouge">_Z3maxIPKcERKT_S4_S4_S4_</code>çš„ä»£ç , å‡½æ•°ä¸¤æ¬¡è°ƒç”¨äº†<code class="language-plaintext highlighter-rouge">_Z3maxPKcS0_</code>, è¿™ä¸ªå‡½æ•°æ²¡æœ‰å°¾ç¼€, æ‰€ä»¥ä¸€å®šæ˜¯ä¸Šé¢æ²¡æœ‰æ¨¡æ¿çš„<code class="language-plaintext highlighter-rouge">max</code>å‡½æ•°. è¿™æ ·ä¹‹å‰çš„å›°æƒ‘å°±å¾—åˆ°äº†è§£å†³, <code class="language-plaintext highlighter-rouge">S4</code>åº”è¯¥æ˜¯<code class="language-plaintext highlighter-rouge">char const*</code>å‹çš„.</p>

<p>è¿™ä¸ªéœ€è¦è€ƒè™‘åˆ°ç¼–è¯‘å™¨çš„æœºåˆ¶äº†. ç«™åœ¨å†™ä»£ç äººçš„è§’åº¦è€ƒè™‘, åˆšæ‰è¯´è¿‡:</p>
<blockquote>
  <p>åœ¨å¸¸è§„æƒ…å†µä¸‹, åº”è¯¥å°½é‡ä¸åœ¨ä¸å¿…è¦é‡è½½å‡½æ•°æ¨¡æ¿çš„æ—¶å€™åšæ›´å¤šçš„æ›´æ”¹, ç®€å•ç‚¹è®²å°±æ˜¯å°½é‡ä¸è¦ç”¨æ¨¡æ¿ç”Ÿäº§å‡ºæ›´å¤šçš„å‡½æ•°é‡è½½. å¦åˆ™, å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›å¥‡æ€ªçš„é—®é¢˜</p>
</blockquote>

<p>æ‰€ä»¥ç¼–è¯‘å™¨ä¹Ÿå®šç„¶ä¼šç¬¦åˆè¿™ä¸ªè¦æ±‚åšäº‹ â€“ å¦‚æœèƒ½æ‰¾åˆ°ç°æˆçš„å‡½æ•°ç­¾åèƒ½ç¬¦åˆè¦æ±‚, å°±ä¸å†é€šè¿‡æ¨¡æ¿å»å†ç”Ÿæˆä¸€å¥—ä»£ç , æ¯•ç«Ÿä¸ºäº†é˜²æ­¢å†²çªå˜›. ä¸»å‡½æ•°ä¸­çš„Cé£æ ¼å­—ç¬¦ä¸²æ˜¯<code class="language-plaintext highlighter-rouge">char const*</code>å‹çš„, é¦–å…ˆç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€å¥—<code class="language-plaintext highlighter-rouge">T</code>ä¸º<code class="language-plaintext highlighter-rouge">char const*</code>çš„ä¸‰å‚æ•°<code class="language-plaintext highlighter-rouge">max</code>å‡½æ•°ä»£ç . å¹¶ä¸”ä»¥å¼•ç”¨çš„æ–¹å¼å°†ä¸»å‡½æ•°ä¸­çš„ä¸‰ä¸ªå­—ç¬¦å‹æŒ‡é’ˆä¼ åˆ°äº†è¿™ä¸ª<code class="language-plaintext highlighter-rouge">max</code>é‡Œ. ä½†æ˜¯åœ¨ä¸‰å‚æ•°<code class="language-plaintext highlighter-rouge">max</code>è°ƒç”¨äºŒå‚æ•°<code class="language-plaintext highlighter-rouge">max</code>çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯<code class="language-plaintext highlighter-rouge">char const*</code>ç‰ˆæœ¬, å®ƒçš„è¿”å›å€¼ä¹Ÿæ˜¯<code class="language-plaintext highlighter-rouge">char const*</code>. è€Œä¸‰å‚æ•°<code class="language-plaintext highlighter-rouge">max</code>å°†<code class="language-plaintext highlighter-rouge">max (max(a,b), c)</code>è°ƒç”¨ä¹‹åä¸´æ—¶ç”Ÿæˆçš„å±€éƒ¨å˜é‡å¼•ç”¨è¿”å›äº†, ä½†å®é™…è¿™ä¸ªä¸´æ—¶å˜é‡åœ¨ä¸‰å‚æ•°<code class="language-plaintext highlighter-rouge">max</code>è¿”å›ä¹‹åå°±å·²ç»é”€æ¯äº†, æ‰€ä»¥, dangling referenceå‡ºç°åœ¨è¿™é‡Œ.</p>

<p>ä¸ºä»€ä¹ˆæ•´å‹è°ƒç”¨çš„æ—¶å€™æ²¡æœ‰å‡ºç°è¿™ç§æƒ…å†µ? é‚£æ˜¯å› ä¸º<code class="language-plaintext highlighter-rouge">int</code>å‹çš„ä¸‰å‚æ•°<code class="language-plaintext highlighter-rouge">max</code>è°ƒç”¨çš„æ˜¯æ¨¡æ¿å®ä¾‹åŒ–å‡ºæ¥çš„äºŒå‚æ•°<code class="language-plaintext highlighter-rouge">max</code>, å…¨ç¨‹ä½¿ç”¨å¼•ç”¨, æ‰€ä»¥ä¸å­˜åœ¨è¿™æ ·çš„é—®é¢˜.</p>

<p>å…¶å®æŠŠ<code class="language-plaintext highlighter-rouge">char const*</code>å‚æ•°ç‰ˆæœ¬çš„<code class="language-plaintext highlighter-rouge">max</code>çš„å®šä¹‰ç»™åˆ æ‰, è¿™ä¸ªä»£ç å°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†. æˆ–è€…å°†å‚æ•°ç±»å‹æ”¹æˆ<code class="language-plaintext highlighter-rouge">char const* const&amp;</code>.</p>

<p>ä¸‹é¢è¿™ä¸ªä»£ç , æ¶‰åŠä¸€ç§ç‰¹æ®Šæƒ…å†µ:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;iostream&gt;
</span>
<span class="c1">// maximum of two values of any type:</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"max&lt;T&gt;() </span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// maximum of three values of any type:</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">,</span> <span class="n">T</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">max</span> <span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">),</span> <span class="n">c</span><span class="p">);</span>  <span class="c1">// uses the template version even for ints</span>
<span class="p">}</span>  <span class="c1">// because the following declaration comes</span>
   <span class="c1">// too late:</span>

<span class="c1">// maximum of two int values:</span>
<span class="kt">int</span> <span class="nf">max</span> <span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"max(int,int) </span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="mi">47</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">33</span><span class="p">);</span>  <span class="c1">// OOPS: uses max&lt;T&gt;() instead of max(int,int)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™é‡Œä¸ºä»€ä¹ˆä¼šè°ƒç”¨æ¨¡æ¿çš„ç‰ˆæœ¬, å› ä¸ºå¯¹äºä¸‰å‚æ•°<code class="language-plaintext highlighter-rouge">max</code>æ¥è¯´, æ¨¡æ¿ç‰ˆæœ¬çš„äºŒå‚æ•°<code class="language-plaintext highlighter-rouge">max</code>åœ¨å…¶ä¹‹å‰è¢«å£°æ˜, è€Œéæ¨¡æ¿ç‰ˆæœ¬çš„<code class="language-plaintext highlighter-rouge">max</code>åœ¨å…¶ä¹‹åè¢«å£°æ˜, æ‰€ä»¥æ²¡æœ‰å¯è§æ€§.</p>

<h3 id="but-shouldnt-we--ä½†æ˜¯-ä»€ä¹ˆæ˜¯ç¦æ­¢åšçš„">But, Shouldnâ€™t We â€¦? ä½†æ˜¯, ä»€ä¹ˆæ˜¯ç¦æ­¢åšçš„?</h3>
<h4 id="pass-by-value-or-by-reference-å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’">Pass by Value or by Reference? å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’?</h4>
<p>è¿™ä¸ªé—®é¢˜ä¸Šé¢é‡åˆ°äº†. ç›´æ¥ç»™å‡ºç­”æ¡ˆå°±æ˜¯æ›´å¤šçš„æ—¶å€™ä½¿ç”¨å€¼ä¼ é€’. ä½†æ˜¯å¾ˆå¥‡æ€ª, ä¹‹å‰çœ‹è¿‡çš„ä¹¦ä¸Šæˆ–è€…äººä»¬æ¨å´‡çš„ä¸éƒ½æ˜¯å¼•ç”¨+<code class="language-plaintext highlighter-rouge">const</code>ä¿®é¥°æ¥ä¼ é€’é™¤ç®€å•ç±»å‹(æ¯”å¦‚fundamental typesæˆ–è€…<code class="language-plaintext highlighter-rouge">std::string_view</code>)å¤–çš„å…¶ä»–ç±»å‹å—? ä¸ºä»€ä¹ˆè¿™é‡Œåˆå»ºè®®ç”¨å€¼ä¼ é€’äº†? ä¹¦ä¸­ç»™å‡ºäº†å€¼ä¼ é€’çš„å¥½å¤„:</p>
<ul>
  <li>The syntax is simple.</li>
  <li>è¯­æ³•ç®€å•.</li>
  <li>Compilers optimize better.</li>
  <li>ç¼–è¯‘å™¨æ›´å®¹æ˜“ä¼˜åŒ–.</li>
  <li>Move semantics often makes copies cheap.</li>
  <li>ç§»åŠ¨è¯­ä¹‰æ›´å®¹æ˜“ä½œç”¨äºæ‹·è´ä¼ é€’.</li>
  <li>And sometimes there is no copy or move at all.</li>
  <li>æœ‰æ—¶æ ¹æœ¬ä¸ä¼šæœ‰æ‹·è´å’Œç§»åŠ¨. è¿™å¥æ²¡æ€ä¹ˆæ‡‚.<br />
å¦å¤–, åŠ ä¸Šæ¨¡æ¿å:</li>
  <li>A template might be used for both simple and complex types, so choosing the approach for complex types might be counter-productive for simple types.</li>
  <li>æ¨¡æ¿å‚æ•°å¯ä»¥æ¥æ”¶ç®€å•ç±»å‹å’Œå¤æ‚ç±»å‹, å¦‚æœä¸€å‘³åœ°ä½¿ç”¨å¯¹ä¸“é—¨å¯¹å¤æ‚ç±»å‹è€ƒè™‘çš„ä¼˜åŒ–æ“ä½œ, æœ‰å¯èƒ½ä¼šå¯¹ç®€å•ç±»å‹äº§ç”Ÿé€‚å¾—å…¶åçš„æ•ˆæœ.</li>
  <li>As a caller you can often still decide to pass arguments by reference, using std::ref() and std::cref() (see Section 7.3 on page 112).</li>
  <li>functionalä¸­æä¾›äº†å¯ä¾›è°ƒç”¨è€…å†³å®šä½¿ç”¨çš„<code class="language-plaintext highlighter-rouge">std::ref()</code>å’Œ<code class="language-plaintext highlighter-rouge">std::cref()</code>è¿›è¡Œå¼ºåˆ¶å¼•ç”¨.</li>
  <li>Although passing string literals or raw arrays always can become a problem, passing them by reference often is considered to become the bigger problem. All this will be discussed in detail in Chapter 7. For the moment inside the book we will usually pass arguments by value unless some functionality is only possible when using references.</li>
  <li>å­—ç¬¦ä¸²å­—é¢å€¼å’ŒåŸç”Ÿæ•°ç»„å¯èƒ½ä¼šåœ¨å¼•ç”¨æ—¶é‡åˆ°æ›´å¤§çš„éº»çƒ¦. æ›´å¤šçš„å†…å®¹ä¼šåœ¨åé¢è®¨è®º.</li>
</ul>

<h4 id="why-not-inline-å†…è”å‡½æ•°">Why Not inline? å†…è”å‡½æ•°</h4>
<p>ä¸çŸ¥é“åŸæ–‡åœ¨è¯´å•¥, ä¹Ÿä»æ¥ä¸ç”¨<code class="language-plaintext highlighter-rouge">inline</code>, æ‡’å¾—çœ‹äº†.</p>

<h4 id="why-not-constexpr-constexprå‡½æ•°">Why Not constexpr? <code class="language-plaintext highlighter-rouge">constexpr</code>å‡½æ•°</h4>
<p>ç¼–è¯‘æœŸå‡½æ•°å˜›, å­¦è¿‡C++çš„éƒ½çŸ¥é“. ä¸Šä»£ç :</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">T2</span><span class="p">&gt;</span>
<span class="k">constexpr</span> <span class="k">auto</span> <span class="nf">max</span> <span class="p">(</span><span class="n">T1</span> <span class="n">a</span><span class="p">,</span> <span class="n">T2</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ç„¶åå°±å¯ä»¥</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span><span class="mi">1000u</span><span class="p">)];</span>
<span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span><span class="mi">1000u</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">arr</span><span class="p">;</span>
</code></pre></div></div>
<p>äº†, ç”¨æ³•æ²¡ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹. ä½†æ˜¯è¦æ³¨æ„ä¸€å®šè¦ä¼ <code class="language-plaintext highlighter-rouge">unsigned</code>å‹çš„å­—é¢å€¼, ä¸ç„¶æ¯”è¾ƒå¤§å°çš„æ—¶å€™ä¼šæœ‰è­¦å‘Š.</p>

<h3 id="ç« æ€»ç»“">ç« æ€»ç»“</h3>
<ul>
  <li>å‡½æ•°æ¨¡æ¿èƒ½ä¸ºä¸åŒæ¨¡æ¿å‚æ•°ç”Ÿæˆä¸€ä¸ªå®¶æ—æˆ–è€…è¯´æ˜¯ä¸€ä¸ªç³»åˆ—çš„å‡½æ•°.</li>
  <li>ä½ ä¼ å®é™…å‚æ•°è¿›ç”¨æ¨¡æ¿å‚æ•°ç±»å‹çš„å‚æ•°æ—¶, å¤§å¤šæƒ…å†µä¸‹ç¼–è¯‘æœŸä¼šè‡ªåŠ¨æ¨å¯¼æ¨¡æ¿å‚æ•°.</li>
  <li>å¯ä»¥æŒ‡å®šleadingçš„æ¨¡æ¿å‚æ•°. <br />
  ä¸¾ä¸ªä¾‹å­å°±æ˜¯<code class="language-plaintext highlighter-rouge">template&lt;typename RT, typename T1, typename T2&gt;</code>, ä¹‹å‰çš„è¿™ä¸ª<code class="language-plaintext highlighter-rouge">RT</code>å°±æ˜¯æ‰€è°“çš„leading.</li>
  <li>å¯ä»¥æŒ‡å®šé»˜è®¤æ¨¡æ¿å‚æ•°.</li>
  <li>å¯ä»¥é‡è½½å‡½æ•°æ¨¡æ¿.</li>
  <li>åœ¨æ‰‹åŠ¨é‡è½½å‡½æ•°æ¨¡æ¿ä¹‹å‰, ç¡®ä¿é‡è½½å‡ºæ¥çš„å‡½æ•°ç­¾åæ²¡æœ‰ç”¨è¿‡, æˆ–è€…æ˜¯äº§ç”Ÿå†²çªä¹‹ç±»çš„.</li>
  <li>å°½é‡å°‘çš„é‡è½½å‡½æ•°æ¨¡æ¿, ä¸»è¦ä¹Ÿå°±æ˜¯é˜²æ­¢å†²çª.</li>
  <li>ç¡®ä¿è°ƒç”¨æŸä¸ªå‡½æ•°æ—¶ç¼–è¯‘å™¨å¯¹æ‰€æœ‰å‡½æ•°é‡è½½ç‰ˆæœ¬çš„å¯è§æ€§.</li>
</ul>

<h2 id="chapter-2---class-templates-ç±»æ¨¡æ¿">Chapter 2 - Class Templates ç±»æ¨¡æ¿</h2>
<h3 id="implementation-of-class-template-stack-ç±»æ¨¡æ¿æ ˆçš„å®ç°">Implementation of Class Template Stack ç±»æ¨¡æ¿æ ˆçš„å®ç°</h3>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;vector&gt;
#include &lt;cassert&gt;
</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">Stack</span> <span class="p">{</span>
  <span class="nl">private:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">elems</span><span class="p">;</span>
  <span class="nl">public:</span>
    <span class="kt">void</span> <span class="n">push</span><span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">elem</span><span class="p">);</span>
    <span class="kt">void</span> <span class="n">pop</span><span class="p">();</span>
    <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">top</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">empty</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">elems</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="kt">void</span> <span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">push</span> <span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">elem</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">elems</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">elem</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="kt">void</span> <span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">pop</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="n">elems</span><span class="p">.</span><span class="n">empty</span><span class="p">());</span>
    <span class="n">elems</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">top</span> <span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="n">elems</span><span class="p">.</span><span class="n">empty</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">elems</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™ä¸ªç±»æ¨¡æ¿å†…éƒ¨è°ƒç”¨äº†C++æ ‡å‡†åº“çš„vector&lt;&gt;ç±»æ¨¡æ¿. æ‰€ä»¥åœ¨åšå®ƒçš„å®ç°çš„æ—¶å€™ä¸ç”¨è€ƒè™‘å†…å­˜ç®¡ç†, æ‹·è´æ„é€ å™¨, èµ‹å€¼è¿ç®—ç¬¦è¿™äº›ä¸œè¥¿.</p>

<h4 id="declaration-of-class-templates-ç±»æ¨¡æ¿çš„å£°æ˜">Declaration of Class Templates ç±»æ¨¡æ¿çš„å£°æ˜</h4>
<p>å£°æ˜ç±»æ¨¡æ¿å’Œå‡½æ•°æ¨¡æ¿åŸºæœ¬ä¸€è‡´:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">Stack</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">};</span>
</code></pre></div></div>
<p>åŒæ ·çš„, è¿™é‡Œçš„<code class="language-plaintext highlighter-rouge">typename</code>ä¹Ÿå¯ä»¥ç”¨<code class="language-plaintext highlighter-rouge">class</code>æ›¿ä»£.</p>

<p>åŒå‡½æ•°æ¨¡æ¿ä¸€æ ·, åœ¨æŠŠç±»æ¨¡æ¿ç”¨ä½œå£°æ˜çš„æ—¶å€™éœ€è¦æŒ‡å®šæ¨¡æ¿å‚æ•°, é™¤éæ¨¡æ¿å‚æ•°é€šè¿‡æŸç§é€”å¾„èƒ½å¤Ÿè¢«ç¼–è¯‘å™¨è‡ªåŠ¨æ¨å¯¼.</p>

<p>ä½†æ˜¯åœ¨ç±»çš„å®šä¹‰ä¸­ä½¿ç”¨è‡ªå·±çš„ç±»åæ—¶ä¸éœ€è¦æŒ‡å®šæ¨¡æ¿å‚æ•°, ä¸æŒ‡å®šæ—¶å°±è¡¨ç¤ºä»–è‡ªå·±, ç”¨Javaçš„è¯è¯´å°±æ˜¯<code class="language-plaintext highlighter-rouge">this.class</code>:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">Stack</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="n">Stack</span> <span class="p">(</span><span class="n">Stack</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">);</span>
    <span class="n">Stack</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span> <span class="p">(</span><span class="n">Stack</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">};</span>
</code></pre></div></div>
<p>ç­‰ä»·äº:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">Stack</span> <span class="p">{</span>
    <span class="n">Stack</span> <span class="p">(</span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">);</span>
    <span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="k">operator</span><span class="o">=</span> <span class="p">(</span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">};</span>
</code></pre></div></div>
<p>ä½†æ˜¯åœ¨ç±»å¤–çš„æˆå‘˜æ–¹æ³•å®šä¹‰ä¸­å‡ºç°çš„ç±»åéœ€è¦æŒ‡å®šæ¨¡æ¿å‚æ•°:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span> <span class="p">(</span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">);</span>
</code></pre></div></div>

<p>æ³¨æ„: ä¸åŒäºéæ¨¡æ¿ç±», ç±»æ¨¡æ¿ä¸èƒ½åœ¨å‡½æ•°æˆ–ä»£ç å—ä¸­å£°æ˜. é€šå¸¸æƒ…å†µä¸‹, æ¨¡æ¿åªèƒ½åœ¨å…¨å±€æˆ–è€…åç§°ç©ºé—´scopeä¸­, ä»¥åŠç±»ä¸­å£°æ˜.</p>

<h4 id="implementation-of-member-functions-æˆå‘˜å‡½æ•°çš„å®ç°">Implementation of Member Functions æˆå‘˜å‡½æ•°çš„å®ç°</h4>
<p>ä¸Šé¢çš„ä»£ç ä¸­, ç±»ä¸­çš„<code class="language-plaintext highlighter-rouge">push</code>å‡½æ•°çš„å®ç°æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«éœ€è¦è¯´æ˜çš„åœ°æ–¹. <br />
ä½†æ˜¯éœ€è¦è¯´æ˜çš„æ˜¯, ä¸ºä»€ä¹ˆ<code class="language-plaintext highlighter-rouge">vector&lt;&gt;::pop_back()</code>æ²¡æœ‰è¿”å›ç§»é™¤çš„é‚£ä¸ªæœ€åçš„å…ƒç´ . è¿™æ ·å¯ä»¥ä¿è¯<em>å¼‚å¸¸å®‰å…¨æ€§(exception safety)</em>, ä½ ä¸å¯èƒ½ä¿è¯è¿”å›ç§»é™¤å…ƒç´ ç‰ˆæœ¬çš„<code class="language-plaintext highlighter-rouge">pop()</code>æ˜¯å®Œå¤‡çš„å¼‚å¸¸å®‰å…¨çš„. <em>æ¯”å¦‚è¯´ç§»é™¤çš„å…ƒç´ ä¸èƒ½è¢«æ‹·è´?</em> å¦‚æœå¿½ç•¥è¿™æ ·çš„é£é™©, å°±å¯ä»¥å®ç°ä¸‹é¢çš„ç‰ˆæœ¬äº†:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">pop</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="n">elems</span><span class="p">.</span><span class="n">empty</span><span class="p">());</span>
    <span class="n">T</span> <span class="n">elem</span> <span class="o">=</span> <span class="n">elems</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
    <span class="n">elems</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">elem</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">top</code>å‡½æ•°ä¹Ÿæ²¡ä»€ä¹ˆéœ€è¦ç‰¹åˆ«è¯´æ˜çš„åœ°æ–¹.</p>

<p><code class="language-plaintext highlighter-rouge">empty</code>å‡½æ•°çš„å®šä¹‰æ—¶å†™åœ¨ç±»å†…çš„, æ‰€ä»¥é»˜è®¤å†…è”.</p>

<h3 id="use-of-class-template-stack-ç±»æ¨¡æ¿æ ˆçš„ä½¿ç”¨">Use of Class Template Stack ç±»æ¨¡æ¿æ ˆçš„ä½¿ç”¨</h3>
<p>çœ‹åŸæ–‡ä¸­ä»‹ç»å¥½åƒè¯´C++17æ‰å¼€å§‹æ”¯æŒç±»æ¨¡æ¿å‚æ•°çš„æ¨å¯¼çš„, ä½†æ˜¯æ­£å¸¸æƒ…å†µå†™C++17çš„æ—¶å€™å…¶å®å¾ˆå°‘, ä¹ æƒ¯ä¸Šè¿˜æ˜¯ä¿ç•™äº†ç±»æ¨¡æ¿å‚æ•°çš„æ‰‹åŠ¨æŒ‡å®š.</p>

<p>ä»£ç éƒ¨åˆ†å­¦è¿‡C++çš„éƒ½ä¼šå†™, ä¸è´´äº†.</p>

<p>æ³¨æ„, åªæœ‰è¢«è°ƒç”¨äº†çš„ç±»æ¨¡æ¿çš„æˆå‘˜å‡½æ•°(å…¶å®æŒ‰ç…§ä»£ç æ¥çœ‹å®ƒä»¬ä¹Ÿéƒ½æ˜¯å‡½æ•°æ¨¡æ¿)æ‰ä¼šè¢«å®ä¾‹åŒ–.</p>

<p>ä¸‹é¢çš„è¡Œä¸ºéƒ½æ˜¯è¢«å…è®¸çš„:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="n">Stack</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="n">IntStack</span> <span class="o">=</span> <span class="n">Stack</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="n">Stack</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">istack</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="n">IntStack</span> <span class="n">istack2</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>

    <span class="n">Stack</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">*&gt;</span> <span class="n">floatPtrStack</span><span class="p">;</span>

    <span class="n">Stack</span><span class="o">&lt;</span><span class="n">Stack</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">intStackStack</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°, ç±»æ¨¡æ¿ç±»å‹å¯ä»¥alias, æ”¯æŒç±»å‹é—­åŒ….</p>

<h3 id="partial-usage-of-class-templates-ç±»æ¨¡æ¿çš„éƒ¨åˆ†ç”¨æ³•">Partial Usage of Class Templates ç±»æ¨¡æ¿çš„éƒ¨åˆ†ç”¨æ³•</h3>
<p>æ¨¡æ¿å‚æ•°<strong>å¿…é¡»</strong>æä¾›æ‰€æœ‰éœ€è¦çš„æ“ä½œç¬¦æ”¯æŒ.</p>

<h4 id="concepts">Concepts</h4>
<p>åˆšæ‰è¯´äº†æ¨¡æ¿å‚æ•°å¿…é¡»è¦æä¾›æ‰€æœ‰éœ€è¦çš„æ”¯æŒ, è¿™ä¸ªè¯¥å¦‚ä½•åŠåˆ°å‘¢? C++17æ­£å¼å¼•å…¥äº†æ–°çš„è¯­ä¹‰<em>æ¦‚å¿µ(concept)</em>, æ¥æä¾›åœ¨<strong>æ ‡å‡†åº“ä¸­</strong>æ¨¡æ¿å®ä¾‹åŒ–æ—¶çš„ä¸€äº›é™åˆ¶.<br />
ä½†æ˜¯å¾ˆå¯æƒœçš„æ˜¯, C++17ä½¿ç”¨conceptsæˆ–å¤šæˆ–å°‘åªæ˜¯å‡ºç°åœ¨æ ‡å‡†æ–‡æ¡£æˆ–è€…æ³¨é‡Šä¸­, çœŸæ­£å¼•å…¥æ˜¯C++20. C++20æ­£å¼å¼•å…¥<em>concept</em>æˆä¸ºäº†C++è¯­æ³•çš„ä¸€ä¸ªéƒ¨åˆ†. ç›®å‰ä¸è®ºæ˜¯20çš„range, è¿˜æ˜¯concepts, è¿™æ–¹é¢çš„èµ„æ–™æ¯”è¾ƒå°‘, æˆ–è€…è¯´æˆ‘æ²¡æœ‰ç‰¹åˆ«å»å…³æ³¨è¿™ä¸ª, æ‰€ä»¥ä»£ç æš‚æ—¶è¿˜ä¸çŸ¥é“åº”è¯¥æ€ä¹ˆå»å†™.</p>

<p>ä½†æ˜¯åˆ«å¿˜äº†, æ—©åœ¨C++11, Modern C++é—®ä¸–çš„æ—¶å€™, C++çš„å…ƒèƒ½åŠ›è¢«å®Œå…¨å¼€å‘, æ ‡å‡†åº“ä¸­åŠ å…¥äº†<strong>type_traits</strong>, æä¾›ç»™æˆ‘ä»¬çš„ä¸€äº›å…ƒå‡½æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">C</span>
<span class="p">{</span>
    <span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_default_constructible</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span> <span class="s">"Class C requires default-constructible elements"</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">};</span>
</code></pre></div></div>
<p><em>traits</em>è¿™æœ¬ä¹¦çš„åé¢è‚¯å®šä¼šè®¨è®ºçš„, çŒœéƒ½ä¸ç”¨çŒœ.</p>

<p>æœ¬ä¹¦çš„Appendix Eéƒ¨åˆ†(ä¹Ÿæ˜¯æœ¬ç¯‡çš„Appendix Eéƒ¨åˆ†, æ”¾åœ¨æœ€åäº†)ç»™å‡ºäº†C++20çš„conceptsçš„ä»£ç å®ç°, è¿™é‡Œå°†ä¼šå°è¯•åœ¨åŠ äº†<code class="language-plaintext highlighter-rouge">-std=c++2a</code>çš„g++ä¸­å¤ç°ä¸‹é¢çš„ä»£ç .</p>

<h3 id="friends-å‹å…ƒ">Friends å‹å…ƒ</h3>

<h2 id="appendix-e---concepts">Appendix E - Concepts</h2>
<p>éå¸¸å¹¸è¿çš„æ˜¯, æ ‡å‡†å§”å‘˜ä¼šåœ¨è¿™æœ¬ä¹¦å‡ºç‰ˆä¹‹å‰, ä¸ºC++20è‰æ¡ˆæå‡ºäº†ä¸€ä¸ªæ–°çš„å†…å®¹ â€“ <strong>concepts</strong>. å¦‚ä»Šæˆ‘æ‰æœ‰å¹¸èƒ½åœ¨è¿™æœ¬ä¹¦çš„é™„å½•çœ‹åˆ°å…³äºC++20 conceptsçš„ç›¸å…³ä»£ç . è™½ç„¶å¯èƒ½å’Œæœ€ç»ˆç‰ˆæœ‰æ‰€åå·®, ä½†æ˜¯æˆ‘ä¼šåœ¨C++2aæ ‡å‡†ä¸‹å°½é‡è¿›è¡Œæ‰€æœ‰å°è¯•. ç›®å‰çš„gccç‰ˆæœ¬æ˜¯<code class="language-plaintext highlighter-rouge">gcc (GCC) 9.2.1 20190827 (Red Hat 9.2.1-1)</code>.</p>

<h3 id="using-concepts-ä½¿ç”¨æ¦‚å¿µ">Using Concepts ä½¿ç”¨<em>æ¦‚å¿µ</em></h3>
<h4 id="dealing-with-requirements-å¤„ç†è¦æ±‚">Dealing with Requirements å¤„ç†<em>è¦æ±‚</em></h4>
<p>é¦–å…ˆ, é€šè¿‡ä¿®å¤å‰é¢Chapter 1ä¸­çš„<code class="language-plaintext highlighter-rouge">max</code>å‡½æ•°æ¨¡æ¿çš„æ¼æ´çš„ä»£ç , å…ˆç†Ÿæ‚‰ä¸€ä¸‹conceptsçš„ç›¸å…³è¯­æ³•.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="n">requires</span> <span class="n">LessThanComparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
    <span class="n">T</span> <span class="nf">max</span><span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ç¨å¾®æ‰¾äº†ä¸€ä¸‹markdownçš„é…ç½®ä»£ç , Java, Pythonçš„é«˜äº®å…³é”®å­—éƒ½çœ‹åˆ°äº†, å°±æ˜¯æ²¡è§åˆ°C++çš„. æ‰€ä»¥, requireså·²ç»æ˜¯å…³é”®å­—äº†, åªæ˜¯è¿™é‡Œæ˜¾ç¤ºä¸å‡ºæ¥.</p>

<p>è¿™ç¬¬ä¸€ä¸ªä»£ç æš‚æ—¶è¿˜æ²¡æ³•è·‘èµ·æ¥. <a href="https://en.cppreference.com/w/cpp/named_req/LessThanComparable"><code class="language-plaintext highlighter-rouge">LessThanComparable</code></a>æ˜¯ä¸€ä¸ªå«åš<a href="https://en.cppreference.com/w/cpp/named_req"><em>named requirements</em></a>çš„ä¸œè¥¿, ä¸æ˜¯æŸä¸ªå¤´æ–‡ä»¶é‡Œé¢å®šä¹‰çš„, 2aæš‚æ—¶è¿˜æ²¡æœ‰è¿™ç©æ„å„¿. ä½†æ˜¯ç¨ååœ¨ä¸‹ä¸€èŠ‚ä¼šç»™å‡ºå¦‚ä½•ä½œä¸ºconceptæ¥æ‰‹åŠ¨å®šä¹‰å®ƒ.</p>

<p><code class="language-plaintext highlighter-rouge">LessThanComparable&lt;T&gt;</code>æ˜¯ä¸€ä¸ª<em>å¸ƒå°”è°“è¯(Boolean predicate)</em>, ç®€å•è¯´å°±æ˜¯ä»–èƒ½å¤Ÿäº§ç”Ÿä¸€ä¸ªå¸ƒå°”å€¼. è¿™ä¸ªå¸ƒå°”è°“è¯é€šè¿‡ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼è¿›è¡Œè¯„ä¼°(åº”è¯¥æ˜¯ç±»ä¼¼traitsçš„ä¸œè¥¿), å¹¶ä¸”æœ€é‡è¦çš„æ˜¯, åŒé™æ€æ–­è¨€, è¿™ä¸ªè¯„ä¼°ä¼šåœ¨ç¼–è¯‘æœŸè¿›è¡Œ, ä¼šåœ¨ç¼–è¯‘æœŸç»™äºˆç¨‹åº<em>çº¦æŸ(constraint)</em>. <br />
å½“æˆ‘ä»¬å°è¯•ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿æ—¶, åœ¨äºŒç›¸ç¿»è¯‘çš„ç¬¬ä¸€é˜¶æ®µç»“æŸä¹‹å, ç¬¬äºŒé˜¶æ®µä¹‹å‰ä¼šä¼˜å…ˆè¿›è¡Œ<strong>requiresè¯­å¥(requires clause)</strong>çš„è¯„ä¼°, å¹¶ä¸”éœ€è¦å…¶äº§ç”Ÿä¸€ä¸ª<code class="language-plaintext highlighter-rouge">true</code>å€¼, ç¬¬äºŒé˜¶æ®µç¿»è¯‘æ‰èƒ½å¼€å§‹; åä¹‹, å¦‚æœå®ƒäº§ç”Ÿäº†ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">false</code>å€¼, ç¼–è¯‘æœŸä¼šå‘å‡ºé”™è¯¯å¹¶æŒ‡å‡ºæ˜¯å“ªä¸€ä¸ª<strong>è¦æ±‚(requirement)</strong>éƒ¨åˆ†å¤±è´¥.</p>

<p><code class="language-plaintext highlighter-rouge">require</code>è¯­å¥ä¸ä¸€å®šéœ€è¦é€šè¿‡<em>æ¦‚å¿µ(concepts)</em>è¿›è¡Œè¡¨ç¤º, ä»»ä½•ä¸€ä¸ªå¸ƒå°”å¸¸é‡è¡¨è¾¾å¼éƒ½å¯ä»¥ä½¿ç”¨, ç”šè‡³å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">true</code>. æ‰€ä»¥æ¥ä¸‹æ¥çš„è¿™ä¸ªä»£ç å°†å¯ä»¥è¿è¡Œ:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
  <span class="nl">private:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span>
  <span class="nl">public:</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">STR</span><span class="p">&gt;</span>
      <span class="n">requires</span> <span class="n">std</span><span class="o">::</span><span class="n">is_convertible_v</span><span class="o">&lt;</span><span class="n">STR</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span>
    <span class="k">explicit</span> <span class="n">Person</span><span class="p">(</span><span class="n">STR</span><span class="o">&amp;&amp;</span> <span class="n">n</span><span class="p">)</span>
     <span class="o">:</span> <span class="n">name</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">STR</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"TMPL-CONSTR for â€™"</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">"â€™</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">};</span>
</code></pre></div></div>
<p>è¿™é‡Œé¢æ¶‰åŠä¸€äº›æ¯”è¾ƒå¤æ‚çš„ä¸œè¥¿, æ¯”å¦‚<em>traits</em>, <em>å®Œç¾è½¬å‘(perfect forwarding)</em>, è¿™äº›æ˜¯æ­£æ–‡éœ€è¦è®¨è®ºçš„ä¸œè¥¿, è¿™é‡Œä¸åšè®¨è®º. <br />
<a href="https://en.cppreference.com/w/cpp/types/is_convertible"><code class="language-plaintext highlighter-rouge">std::is_convertible_v&lt;&gt;</code></a>æ¥è‡ªtraits, åŸæ¥çš„ç‰ˆæœ¬æ˜¯<code class="language-plaintext highlighter-rouge">std::is_convertible&lt;&gt;::value</code>, å­¦ä¹ è¿‡C++17ç‰¹æ€§çš„éƒ½çŸ¥é“, <code class="language-plaintext highlighter-rouge">_v</code>å’Œ<code class="language-plaintext highlighter-rouge">_t</code>è¿™ç§å°¾ç¼€æ˜¯C++17æå‡ºæ¥çš„traitsçš„æ–°ç‰¹æ€§, æ¯”ä»¥å‰æ›´æ–¹ä¾¿ä½¿ç”¨:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">From</span><span class="p">,</span> <span class="k">class</span> <span class="nc">To</span><span class="p">&gt;</span>
<span class="kr">inline</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">is_convertible_v</span> <span class="o">=</span> <span class="n">is_convertible</span><span class="o">&lt;</span><span class="n">From</span><span class="p">,</span> <span class="n">To</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
</code></pre></div></div>
<p>å°±ä¸ç”¨å¤šè¯´äº†, åˆ¤æ–­ç±»å‹è½¬æ¢æ˜¯å¦å¯è¡Œçš„traits.</p>

<p>ä¸Šé¢çš„ä»£ç , åŠ ä¸Šå¤´æ–‡ä»¶è¿›è¡Œç»†å¾®ä¿®æ”¹ä¹‹åçš„ç‰ˆæœ¬æ˜¯:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;type_traits&gt;
#include &lt;string&gt;
#include &lt;iostream&gt;
</span>
<span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
  <span class="nl">private:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span>
  <span class="nl">public:</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">STR</span><span class="p">&gt;</span>
      <span class="n">requires</span> <span class="n">std</span><span class="o">::</span><span class="n">is_convertible_v</span><span class="o">&lt;</span><span class="n">STR</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span>
    <span class="k">explicit</span> <span class="n">Person</span><span class="p">(</span><span class="n">STR</span><span class="o">&amp;&amp;</span> <span class="n">n</span><span class="p">)</span>
     <span class="o">:</span> <span class="n">name</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">STR</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"TMPL-CONSTR for â€™"</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">"â€™</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">g++ -fconcepts -std=c++2a -c ./concepts_demo.cpp</code>è¿›è¡Œç¼–è¯‘, å¯å¾—ç›®æ ‡æ–‡ä»¶.</p>

<h4 id="dealing-with-multiple-requirements-å¤„ç†å¤šè¦æ±‚">Dealing with Multiple Requirements å¤„ç†å¤š<em>è¦æ±‚</em></h4>
<p>ä¸Šä»£ç :</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Seq</span><span class="p">&gt;</span>
  <span class="n">requires</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Seq</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span>
           <span class="n">EqualityComparable</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;</span>
<span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">iterator</span> <span class="nf">find</span><span class="p">(</span><span class="n">Seq</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">seq</span><span class="p">,</span>
                            <span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">value_type</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">seq</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">seq</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>è¿™é‡Œä½¿ç”¨çš„ä¸¤ä¸ªnamed requirement, ç¬¬ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">Sequence</code>, cppreferenceä¸Šæä¾›çš„åç§°æ˜¯<a href="https://en.cppreference.com/w/cpp/named_req/SequenceContainer"><code class="language-plaintext highlighter-rouge">SequenceContainer</code></a>, ç”¨æ¥çº¦æŸæ¨¡æ¿å‚æ•°ä¸ºçº¿æ€§å®¹å™¨; ç¬¬äºŒä¸ª<a href="https://en.cppreference.com/w/cpp/named_req/EqualityComparable"><code class="language-plaintext highlighter-rouge">EqualityComparable</code></a>, ç”¨æ¥çº¦æŸæ¨¡æ¿å‚æ•°å¯ä»¥è¿›è¡Œ<em>ç­‰ä»·æ¯”è¾ƒ</em>(çç¼–çš„, å…¶å®å°±æ˜¯æ”¯ä¸æ”¯æŒ<code class="language-plaintext highlighter-rouge">operator==</code>).</p>

<p>ç„¶åè¡”æ¥è¿™ä¸¤ä¸ªrequirementçš„æ˜¯éå¸¸ç†Ÿæ‚‰çš„<code class="language-plaintext highlighter-rouge">&amp;&amp;</code>é€»è¾‘ä¸”è¿ç®—ç¬¦. åŒæ ·çš„, å¦‚æœæƒ³è¡¨è¾¾â€™alternativeâ€™çš„æ„æ€, å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">||</code>é€»è¾‘æˆ–è¿ç®—ç¬¦. ä½†æ˜¯ä¸æ¨èä½¿ç”¨æˆ–, è¿™å¯èƒ½ä¼šæ½œåœ¨åœ°å¢åŠ ç¼–è¯‘å™¨è´Ÿæ‹….</p>

<p>åœ¨æœ‰äº›æƒ…å†µä¸‹, ç”¨conceptæ˜¯éå¸¸çˆ½çš„:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
  <span class="n">requires</span> <span class="n">Integral</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">||</span>
           <span class="n">FloatingPoint</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="n">T</span> <span class="nf">power</span><span class="p">(</span><span class="n">T</span> <span class="n">b</span><span class="p">,</span> <span class="n">T</span> <span class="n">p</span><span class="p">);</span>
</code></pre></div></div>
<p>è¿™æ ·å­ä½¿ç”¨requirementéå¸¸ç¹ç.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">U</span><span class="p">&gt;</span>
  <span class="n">requires</span> <span class="n">SomeConcept</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">U</span><span class="o">&gt;</span>
<span class="k">auto</span> <span class="n">f</span><span class="p">(</span><span class="n">T</span> <span class="n">x</span><span class="p">,</span> <span class="n">U</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span>
</code></pre></div></div>
<p>ä½¿ç”¨äº†ç”¨æˆ·å®šä¹‰çš„conceptä¹‹å, ç±»ä¼¼çš„æ“ä½œå˜å¾—ç®€å•äº†.</p>

<h4 id="shorthand-notation-for-single-requirements-å•ä¸ªè¦æ±‚çš„ç®€å†™">Shorthand Notation for Single Requirements å•ä¸ª<em>è¦æ±‚</em>çš„ç®€å†™</h4>
<p>åœ¨æ¨¡æ¿å‚æ•°åˆ—è¡¨åé¢å†åŠ ä¸Šä¸€ä¸²requires clauseä¼šè®©ä»£ç æ˜¾å¾—å¤´é‡è„šè½», äºæ˜¯C++æä¾›äº†ä¸€ç§ç¼©å†™çš„æ–¹å¼, ä¸çŸ¥é“è¿™èƒ½ä¸èƒ½ç®—è¯­æ³•ç³–?</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Original </span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
  <span class="n">requires</span> <span class="n">LessThanComparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="n">T</span> <span class="nf">max</span><span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Shorthand Notation</span>
<span class="k">template</span><span class="o">&lt;</span><span class="n">LessThanComparable</span> <span class="n">T</span><span class="p">&gt;</span>
<span class="n">T</span> <span class="nf">max</span><span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>åˆæ¯”å¦‚åˆšæ‰ä¸Šé¢é‚£ä¸ªä»£ç :</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Original </span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Seq</span><span class="p">&gt;</span>
  <span class="n">requires</span> <span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Seq</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span>
           <span class="n">EqualityComparable</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;</span>
<span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">iterator</span> <span class="nf">find</span><span class="p">(</span><span class="n">Seq</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">seq</span><span class="p">,</span>
                            <span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">value_type</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">seq</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">seq</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Shorthand Notation </span>
<span class="k">template</span><span class="o">&lt;</span><span class="n">Sequence</span> <span class="n">Seq</span><span class="p">&gt;</span>
  <span class="n">requires</span> <span class="n">EqualityComparable</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;</span>
<span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">iterator</span> <span class="nf">find</span><span class="p">(</span><span class="n">Seq</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">seq</span><span class="p">,</span>
                            <span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">value_type</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">seq</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">seq</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>è¿™æ ·å°±çœ‹èµ·æ¥èˆ’æœå¤šäº†. <br />
è¿™æ ·å®šä¹‰çš„æ¨¡æ¿è¢«å«åš<em>çº¦æŸæ¨¡æ¿(constrained template)</em>.</p>

<h3 id="defining-concepts-å®šä¹‰æ¦‚å¿µ">Defining Concepts å®šä¹‰<em>æ¦‚å¿µ</em></h3>
<p>æ¦‚å¿µçš„å®šä¹‰æ›´åƒå¸ƒå°”å‹<code class="language-plaintext highlighter-rouge">constexpr</code>å˜é‡æ¨¡æ¿, ä½†æ˜¯æ²¡æœ‰æ˜ç¡®æŒ‡å‡ºå˜é‡ç±»å‹:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="n">MyConcept</span> <span class="o">=</span> <span class="p">...</span> <span class="p">;</span>
</code></pre></div></div>
<p>æ¯”å¦‚åˆšæ‰çš„<code class="language-plaintext highlighter-rouge">LessThanComparable</code>, æˆ‘ä»¬çš„è‡ªä¸»å®šä¹‰æ˜¯:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="n">LessThanComparable</span> <span class="o">=</span> <span class="n">requires</span><span class="p">(</span><span class="n">T</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">{</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="kt">bool</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>
<p>è¿™é‡Œæœ‰ä¸€äº›éå¸¸æœ‰æ„æ€çš„ä¸œè¥¿, é¢ è¦†äº†ä»¥å¾€çš„C++çš„æ¦‚å¿µ.</p>
<ol>
  <li>requiresåé¢åœ†æ‹¬å·é‡Œçœ‹èµ·æ¥åƒå‚æ•°åˆ—è¡¨çš„ä¸œè¥¿, æ˜¯å½»å½»åº•åœ°çš„<strong>è™šæ„å˜é‡(dummy variables)</strong>, è¿™äº›çœ‹ä¸Šå»æ˜¯å‚æ•°çš„è™šå‡å˜é‡, ä¸ä¼šåœ¨ä»»ä½•æ—¶å€™æœ‰ä¸€ä¸ªå®å‚ä¼ è¿›æ¥ä½œä¸ºå½¢å‚è¢«è°ƒç”¨, è€Œåªæ˜¯ç”¨æ¥è¾…åŠ©å®šä¹‰æ¦‚å¿µ.</li>
  <li>è¿™æ®µ<code class="language-plaintext highlighter-rouge">{ x &lt; y } -&gt; bool;</code>çœ‹èµ·æ¥åƒè¿”å›å€¼çš„åˆåƒLambdaçš„ç©æ„å„¿, å…¶å®ä¹Ÿä»…ä»…æ˜¯ç”¨æ¥æè¿°æ¦‚å¿µçš„. è¿™ä¸ª<em>è¯­æ³•(syntax, åŸæ–‡è¿™é‡Œæ²¡æœ‰æŠŠå«åšâ€è¯­å¥â€)</em>æœ‰ä¸¤ä¸ªå«ä¹‰: è¡¨è¾¾å¼<code class="language-plaintext highlighter-rouge">x &lt; y</code>å¿…é¡»åˆæ³•, æ„æ€å°±æ˜¯<code class="language-plaintext highlighter-rouge">T</code>ç±»å‹å¿…é¡»æ”¯æŒ<code class="language-plaintext highlighter-rouge">operator&lt;</code>; è¿™ä¸ªè¡¨è¾¾å¼å¿…é¡»è¦æ”¯æŒè½¬æ¢æˆ<code class="language-plaintext highlighter-rouge">bool</code>ç±»å‹(æ³¨æ„ä¸ä¸€å®šæ˜¯è¦<code class="language-plaintext highlighter-rouge">bool</code>ç±»å‹å€¼).</li>
</ol>

<p>åœ¨è¿™ä¸ª<code class="language-plaintext highlighter-rouge">-&gt;</code>ä¹‹å‰å¯ä»¥æ’å…¥ä¸€ä¸ªå…³é”®å­—<code class="language-plaintext highlighter-rouge">noexcept</code>, è¡¨ç¤ºæ‹¬å·å†…çš„è¡¨è¾¾å¼ä¸ä¼šæŠ›å‡ºå¼‚å¸¸.</p>

<p>è¿™é‡Œå¦‚æœä¸åŠ <code class="language-plaintext highlighter-rouge">-&gt; type</code>, ä¹Ÿå¯ä»¥äº¤ç»™ç¼–è¯‘æœŸè‡ªåŠ¨æ¨å¯¼:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="n">Swappable</span> <span class="o">=</span> <span class="n">requires</span><span class="p">(</span><span class="n">T</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>requiresè¡¨è¾¾å¼è¿˜æ”¯æŒè¡¨ç¤ºç›¸å…³ç±»å‹, æ¯”å¦‚<code class="language-plaintext highlighter-rouge">T</code>ç±»å‹å¦‚æœä½œä¸ºä¸€ä¸ªçº¿æ€§å®¹å™¨å†…éƒ¨åŒ…å«çš„<code class="language-plaintext highlighter-rouge">elem_type</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">iterator</code>ä¹‹ç±»çš„, ä½†æ˜¯æ³¨æ„, è¿™ç©æ„å„¿ä¹Ÿéœ€è¦å®šä¹‰:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Seq</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="n">Sequence</span> <span class="o">=</span> <span class="n">requires</span><span class="p">(</span><span class="n">Seq</span> <span class="n">seq</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">iterator</span><span class="p">;</span>
    <span class="p">{</span> <span class="n">seq</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">Seq</span><span class="o">::</span><span class="n">iterator</span><span class="p">;</span>
    <span class="p">...</span>
<span class="p">};</span>
</code></pre></div></div>
<p>ä½†æ˜¯è¿™é‡Œåˆè¦è€ƒè™‘ä¸€ä¸ªéšæ‚£, å‡è®¾è¿™ä¸ª<code class="language-plaintext highlighter-rouge">Seq</code>æ²¡æœ‰è¿­ä»£å™¨æ€ä¹ˆåŠ? è¿™æ—¶å¯ä»¥ä½¿ç”¨åµŒå¥—çš„requires:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">Seq</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="n">Sequence</span> <span class="o">=</span> <span class="n">requires</span><span class="p">(</span><span class="n">Seq</span> <span class="n">seq</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">iterator</span><span class="p">;</span>
    <span class="n">requires</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Seq</span><span class="o">::</span><span class="n">iterator</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="p">{</span> <span class="n">seq</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">Seq</span><span class="o">::</span><span class="n">iterator</span><span class="p">;</span>
    <span class="p">...</span>
<span class="p">};</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">Iterator</code>å¯ä»¥ä½œä¸ºconceptå†å•ç‹¬å®šä¹‰å˜›.<br />
è¿™ç§åµŒå¥—çš„requiresè¢«å«åš<strong>åµŒå¥—è¦æ±‚(nested requirement)</strong>.</p>

<h3 id="overloading-on-constraints-æ¨¡æ¿çº¦æŸé‡è½½">Overloading on Constraints æ¨¡æ¿çº¦æŸé‡è½½</h3>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸‹é¢çš„ä¸¤ä¸ªå‡½æ•°æ¨¡æ¿å£°æ˜:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="n">IntegerLike</span> <span class="n">T</span><span class="p">&gt;</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">T</span> <span class="n">val</span><span class="p">);</span>
<span class="k">template</span><span class="o">&lt;</span><span class="n">StringLike</span> <span class="n">T</span><span class="p">&gt;</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">T</span> <span class="n">val</span><span class="p">);</span>
</code></pre></div></div>
<p>è¿™ä¸¤ä¸ªå£°æ˜è™½ç„¶ä½¿ç”¨äº†ç›¸åŒçš„æ¨¡æ¿, ä½†æ˜¯<em>çº¦æŸ</em>ä¹Ÿæ˜¯æ¨¡æ¿ç­¾åçš„ä¸€éƒ¨åˆ†, å¹¶ä¸”èƒ½åœ¨é‡è½½æ—¶è¢«æˆåŠŸè¯†åˆ«. <br />
ä½†æ˜¯éœ€è¦ä¿è¯åœ¨ä½¿ç”¨é‡è½½æ—¶, åªæœ‰ä¸€ä¸ªç­¾åçš„çº¦æŸç¬¦åˆè¦æ±‚. æ¯”å¦‚æœ‰è¿™ä¹ˆä¸¤ä¸ªå­—é¢å€¼<code class="language-plaintext highlighter-rouge">"6"_NS</code>å’Œ<code class="language-plaintext highlighter-rouge">"7"_NS</code>, å®ƒä»¬å¯ä»¥åƒæ•´æ•°ä¸€æ ·åšè¿ç®—, æ¯”å¦‚ä¹˜æ³•ç­‰äº<code class="language-plaintext highlighter-rouge">"42"_NS</code>, å¹¶ä¸”èƒ½åƒå­—ç¬¦ä¸²ä¸€æ ·ä½¿ç”¨. è¿™æ ·çš„å­—é¢å€¼ç±»å‹åŒæ—¶åŒ¹é…<code class="language-plaintext highlighter-rouge">IntegerLike</code>å’Œ<code class="language-plaintext highlighter-rouge">StringLike</code>, è‡ªç„¶ä¼šäº§ç”Ÿæ­§ä¹‰. ä½†æ˜¯å¯¹äºè¿™äº›æ­§ä¹‰, ç¼–è¯‘å™¨æœ‰ä¸€äº›è§£å†³æ‰‹æ®µ.</p>

<h4 id="constraint-subsumption-çº¦æŸæ¶µæ‘„">Constraint Subsumption çº¦æŸæ¶µæ‘„</h4>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­å·²ç»è¯´è¿‡äº†çº¦æŸé‡è½½çš„é—®é¢˜. è™½ç„¶å¯èƒ½ä¼šæœ‰å†™ä¸€äº›ç±»å‹ä¼šå¯¹å¤šä¸ªçº¦æŸæ¦‚å¿µåŒæ—¶åŒ¹é…, ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦å°½åŠ›æƒ³åŠæ³•å‡å°‘è¿™æ ·çš„å†²çªå‡ºç°.</p>

<p>æ‰€ä»¥, subsumptionè¿™ä¸ªè¯æ˜¯ä»€ä¹ˆæ„æ€? å°±æ˜¯ç»™æˆ‘ä¸­æ–‡â€æ¶µæ‘„â€æˆ‘ä¹Ÿä¸ä¼šçŸ¥é“ä»–çš„æ„æ€, è¿™é‡Œå…ˆå‚çœ‹äº†ä¸€ä¸‹ç™¾åº¦ç™¾ç§‘, å†æƒ³åŠæ³•ä»åŸæ–‡ä¸­ç†è§£è¿™ä¸ªè¯çš„å«ä¹‰.</p>
<blockquote>
  <p><strong>æ¶µæ‘„</strong>è¿™æ ·çš„è¿‡ç¨‹é€šå¸¸ç”±è®¸å¤šå¤æ‚çš„æ€ç»´æ­¥éª¤ç»„æˆã€‚æ˜¯æ³•å¾‹è§„å®šä¸äº‹å®ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œä»»ä½•ä¸€ä¸ªæ³•å¾‹è¡Œä¸ºæˆ–äº‹ä»¶éƒ½è¦å¯¹åº”ç›¸åº”çš„æ³•å¾‹è§„å®šã€‚<br />
æ³•å¾‹é€‚ç”¨çš„æ¶µæ‘„ï¼šå³å°†å…·ä½“çš„æ¡ˆä¾‹äº‹å®ï¼ˆSachverhalt=Sï¼‰ï¼Œç½®äºæ³•å¾‹è§„èŒƒçš„è¦ä»¶(Tatbestand=T)ä¹‹ä¸‹,ä»¥è·å¾—ä¸€å®šç»“è®ºï¼ˆRï¼‰çš„ä¸€ç§æ€ç»´è¿‡ç¨‹ã€‚æ˜“è¨€ä¹‹ï¼Œå³è®¤å®šæŸç‰¹å®šäº‹å®æ˜¯å¦è¯¥å½“äºæ³•å¾‹è§„èŒƒçš„è¦ä»¶ï¼Œè€Œå‘ç”Ÿä¸€å®šçš„æƒåˆ©ä¹‰åŠ¡å…³ç³»ã€‚</p>
</blockquote>

<p>ç»è¿‡ä¸€å®šçš„ç†è§£å, å¯ä»¥æŠŠâ€æ¶µæ‘„â€ç›´æ¥ç†è§£æˆ<em>æ¡ä»¶çš„åŒ…å«</em>, å…·ä½“åŒ–åˆ°C++åº”è¯¥å«<em>æ¦‚å¿µçš„åŒ…å«</em>.</p>

<p>æœ‰äº›æ—¶å€™å¯èƒ½éœ€è¦æä¾›ä¸€ç³»åˆ—ç±»ä¼¼çš„æ¦‚å¿µ, è¿™äº›æ¦‚å¿µä¹‹é—´å­˜åœ¨æ¶µæ‘„å…³ç³». æ¯”å¦‚æ ‡å‡†åº“çš„è¿­ä»£å™¨åˆ†ç±»: input iterator, forward iterator, bidirectional iterator, randomaccess iteratorç­‰ç­‰, ä»¥åŠC++17æä¾›çš„contiguous iterator(é‚»æ¥è¿­ä»£å™¨, è¿™ä¸ªæˆ‘æ˜¯çœŸçš„æ²¡è§è¿‡).</p>

<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå…³äº<code class="language-plaintext highlighter-rouge">ForwardIterator</code>çš„å®šä¹‰:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="n">ForwardIterator</span> <span class="o">=</span> <span class="p">...;</span>
</code></pre></div></div>

<p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åŸºäº<code class="language-plaintext highlighter-rouge">ForwardIterator</code>å®šä¹‰ä¸€ä¸ªæ›´åŠ ç²¾è‡´(åŸæ–‡æ˜¯more refined)æ¦‚å¿µ<code class="language-plaintext highlighter-rouge">BidirectionalIterator</code>:</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="n">concept</span> <span class="n">BidirectionalIterator</span> <span class="o">=</span>
    <span class="n">ForwardIterator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span>
    <span class="n">requires</span> <span class="p">(</span><span class="n">T</span> <span class="n">it</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">{</span> <span class="o">--</span><span class="n">it</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="o">&amp;</span>
    <span class="p">};</span>
</code></pre></div></div>
<p>è¿™æ ·æˆ‘ä»¬åŸºäºforward iteratorsæä¾›çš„æœºèƒ½, åˆæ·»åŠ äº†å‰ç¼€è‡ªå‡è¿ç®—ç¬¦çš„æœºèƒ½, åˆ›é€ äº†å¯¹bidirectional iteratorsçš„æ¦‚å¿µ.</p>

<p>æ¥ç€è€ƒè™‘å®ç°<code class="language-plaintext highlighter-rouge">std::advance()</code>ç®—æ³•, ä½¿ç”¨çº¦æŸæ¨¡æ¿å¯¹forward iteratorså’Œbidirectional iteratorsè¿›è¡Œé‡è½½.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">template</span><span class="o">&lt;</span><span class="n">ForwardIterator</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">D</span><span class="p">&gt;</span>
<span class="kt">void</span> <span class="nf">advanceIter</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">it</span><span class="p">,</span> <span class="n">D</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="o">++</span><span class="n">it</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="n">BidirectionalIterator</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="nc">D</span><span class="p">&gt;</span>
<span class="kt">void</span> <span class="nf">advanceIter</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">it</span><span class="p">,</span> <span class="n">D</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(;</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="o">++</span><span class="n">it</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(;</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">++</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="o">--</span><span class="n">it</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¾ˆæ˜¾ç„¶, ä¼ ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">ForwardIterator</code>ä½œä¸º<code class="language-plaintext highlighter-rouge">advanceIter</code>çš„æ¨¡æ¿å‚æ•°, ä¼šè¢«ç¬¬ä¸€ä¸ªæ¨¡æ¿é€‰æ‹©, å› ä¸ºåªæœ‰ç¬¬ä¸€ä¸ªæ¨¡æ¿ç¬¦åˆè¦æ±‚. ä½†æ˜¯å¦‚æœä¼ ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">BidirectionalIterator</code>ä½œä¸ºæ¨¡æ¿å‚æ•°, ä¸Šé¢çš„ä¸¤ä¸ªæ¨¡æ¿éƒ½åŒ¹é…. è¿™æ—¶ç¼–è¯‘å™¨ä¼šé€‰æ‹©<em>æ›´ç²¾ç¡®</em>æ¦‚å¿µ. å› ä¸ºå‰é¢è¯´è¿‡, <code class="language-plaintext highlighter-rouge">BidirectionalIterator</code>æ¶µæ‘„<code class="language-plaintext highlighter-rouge">ForwardIterator</code>, å‰è€…æ¯”åè€…<em>æ›´ç²¾ç¡®</em>, æ‰€ä»¥ç¼–è¯‘å™¨é’ˆå¯¹<code class="language-plaintext highlighter-rouge">BidirectionalIterator</code>ä¼šé€‰æ‹©ç¬¬äºŒä¸ªæ¨¡æ¿è¿›è¡Œå®ä¾‹åŒ–.</p>

<h4 id="constraints-and-tag-dispatching-çº¦æŸå’Œæ ‡ç­¾è°ƒåº¦">Constraints and Tag Dispatching çº¦æŸå’Œæ ‡ç­¾è°ƒåº¦</h4>
<p>æ ‡ç­¾è°ƒåº¦æš‚æ—¶æ²¡æœ‰çœ‹åˆ°, å…ˆç•™ç€.</p>

<h3 id="concept-tips-å°æç¤º">Concept Tips å°æç¤º</h3>
<p>æœ€å, ä¹Ÿæ˜¯è¿™æœ¬ä¹¦çš„æœ€æœ€å, ä»–ä»¬å¸Œæœ›åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­èƒ½æä¾›æ›´å¤šå®ç”¨çš„å…³äºå¦‚ä½•è®¾è®¡<em>çº¦æŸæ¨¡æ¿åº“</em>çš„æ•™ç¨‹. æœ¬äººåœ¨æ­¤æ„Ÿè°¢ä½œè€…ä»¬çš„è¾›å‹¤ä»˜å‡º.</p>

<p>æ¥ç€æä¾›ä¸‰ä¸ªè§‚å¯Ÿ(observation).</p>

<h4 id="testing-concepts-æµ‹è¯•æ¦‚å¿µ">Testing Concepts æµ‹è¯•æ¦‚å¿µ</h4>
<p>ä¹‹å‰è¯´è¿‡æ¦‚å¿µå…¶å®å°±æ˜¯å¸ƒå°”è°“è¯, ä»–ä»¬å…¶å®å°±æ˜¯åˆæ³•çš„å¸ƒå°”å¸¸é‡è¡¨è¾¾å¼, äºæ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹æ¦‚å¿µä½¿ç”¨é™æ€æ–­è¨€.</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static_assert</span><span class="p">(</span><span class="n">C</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="p">...</span><span class="o">&gt;</span><span class="p">,</span> <span class="s">"Model failure"</span><span class="p">);</span>
</code></pre></div></div>
<p>ä¹¦ä¸­å»ºè®®ä½¿ç”¨è¿™ç§æ–¹æ³•æµ‹è¯•æ¦‚å¿µå¯¹ç®€å•ç±»å‹çš„è®¾è®¡. åŒ…æ‹¬æ¨å‘æ¦‚å¿µæ„å‘³ç€ä»€ä¹ˆçš„è¾¹ç•Œçš„ç±»å‹, å›ç­”ç±»ä¼¼ä¸‹é¢çš„é—®é¢˜:</p>
<ul>
  <li>Do interfaces and/or algorithms need to copy and/or move objects of the types being modeled?</li>
  <li>æ¥å£å’Œ/æˆ–ç®—æ³•éœ€è¦<em>è¢«ä»¿é€ ç±»å‹</em>å¤åˆ¶å’Œ/æˆ–ç§»åŠ¨çš„å¯¹è±¡å—?</li>
  <li>What conversions are acceptable? Which ones are needed?</li>
  <li>ä»€ä¹ˆæ ·çš„ç±»å‹è½¬æ¢æ˜¯è®¸å¯çš„? è€Œå…¶ä¸­åˆæœ‰å“ªäº›æ˜¯éœ€è¦çš„?</li>
  <li>Is the basic set of operations assumed by the template unique? For example, can it operate using either *= or * and =?</li>
  <li>ç‰¹å®šæ¨¡æ¿æ˜¯å¦èƒ½ä½¿ç”¨åŸºç¡€è¿ç®—é›†åˆ? æ¯”å¦‚, å®ƒæ˜¯å¦æ”¯æŒ<code class="language-plaintext highlighter-rouge">*=</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">*</code>å’Œ<code class="language-plaintext highlighter-rouge">=</code>?</li>
</ul>

<h4 id="concept-granularity-æ¦‚å¿µç²’åº¦">Concept Granularity æ¦‚å¿µç²’åº¦</h4>
<p>ä»è¿™é‡Œå¼€å§‹, è‹±è¯­æ°´å¹³å®åœ¨ä¼˜å…ˆ, çœ‹ä¸æ‡‚, å…ˆå‘Šè¾äº†.</p>
:ET